import{j as e,T as f,R as es,d as ss,e as ts,f as as,S as ke,M as ve,g as we,o as ls,p as rs,q as ns,B as L,P as os}from"./ui-vendor-BA4r0Vfc.js";import{a as l,L as is}from"./react-vendor-CIX8g8kC.js";import{b as T,B as W,C,a as S,c as B,d as D,I as re,s as cs}from"./api-CX4-puwJ.js";import{S as Ce,a as Se,b as Be,c as De,d as u}from"./select-Bpe-XtYI.js";import{A as Te,D as ds,g as ms,h as xs,i as X,a as P,b as R,c as Y,d as J,j as ne,e as M,f as F,k as oe}from"./AdminLayout-Dhh5Bieh.js";import{T as Ae}from"./textarea-OUeqgjUD.js";import{B as hs}from"./bus-seat-layout-Bhp5QN2H.js";import{S as Ee,E as us}from"./success-message-B9ZFEvVV.js";import{R as gs}from"./index-DiI8FQ00.js";import{L as N}from"./label-DadenG8h.js";import{T as Le}from"./skeleton-CJNjmkgT.js";import{f as Pe}from"./utils-vendor-D-f4oM49.js";import"./badge-sFmlWEB5.js";import"./query-vendor-COMjhFa0.js";function bs(){const[m,$]=l.useState([]),[j,O]=l.useState(!0),[Z,I]=l.useState(null),y=l.useCallback(async()=>{try{O(!0),I(null);const i=await T.getAllBookings({page:1,limit:1e3});$(i.data.bookings||i.data)}catch(i){let A="Failed to fetch bookings";i instanceof Error&&(A=i.message),I(A)}finally{O(!1)}},[]);l.useEffect(()=>{y()},[y]);const h=l.useMemo(()=>m.length,[m]),q=l.useMemo(()=>m.filter(i=>i.status==="BOOKED").length,[m]),t=l.useMemo(()=>m.filter(i=>i.status==="COMPLETED").length,[m]),z=l.useMemo(()=>m.filter(i=>i.status==="CANCELLED").length,[m]),U=l.useCallback(async()=>{await y()},[y]);return{bookings:m,loading:j,error:Z,refreshBookings:U,totalBookings:h,pendingBookings:q,completedBookings:t,cancelledBookings:z}}function Es(){const{bookings:m,loading:$,refreshBookings:j}=bs(),O=m.length,Z=m.filter(s=>s.status==="PENDING").length,I=m.filter(s=>s.status==="COMPLETED").length,y=m.filter(s=>s.status==="CANCELLED").length,[h,q]=l.useState(null),[t,z]=l.useState(null),[U,i]=l.useState(null),[A,k]=l.useState(null),[Re,ee]=l.useState(!1),[Me,se]=l.useState(!1),[ie,ce]=l.useState(!1),[Fe,te]=l.useState(!1),[K,G]=l.useState(null),[de,me]=l.useState(""),[xe,he]=l.useState(""),[ue,ge]=l.useState(""),[be,pe]=l.useState(!1),[g,$e]=l.useState(""),[p,Oe]=l.useState("all"),[Q,Ie]=l.useState(""),[V,qe]=l.useState(""),[H,b]=l.useState(!1),[fe,Ne]=l.useState(!1),[x,ze]=l.useState(null),[v,w]=l.useState(null),je=l.useRef(null),[ye,ae]=l.useState(null),Ue=async()=>{pe(!0);try{await j(),i("Bookings refreshed successfully!"),setTimeout(()=>{i(null)},3e3)}catch{k("Failed to refresh bookings.")}finally{pe(!1)}},Ke=async()=>{if(K){b(!0);try{k(null),await T.updateBookingStatus(K.id,{status:de,reason:xe}),i("Booking status updated successfully!"),se(!1),G(null),me(""),he(""),await j(),setTimeout(()=>{i(null)},3e3)}catch(s){let r="Failed to update booking  status.";s&&typeof s=="object"&&"message"in s&&(r=s.message),k(r)}finally{b(!1)}}},Ge=async()=>{if(v){je.current=v,Ne(!0);try{const s=await T.removeSeatFromBooking(v.bookingId,v.seatNumber);if(w(null),await j(),ie&&t?.ticketNumber){const a=(await T.getTicketByNumber(t.ticketNumber)).data;q(a);const o=a.bookings.map(n=>n.seat?.seatNumber).filter(Boolean).join(", "),d=a.bookings.reduce((n,E)=>n+(E.payment?.amount||0),0),c=a.bookings[0];z({ticketNumber:a.ticketNumber||"N/A",qrCode:a.qrCode||"",passengerName:c?.user?.name||"N/A",passengerPhone:c?.user?.phoneNumber||c?.customerPhone||"N/A",status:c?.status||"N/A",route:c?.schedule?.route?`${c.schedule.route.origin} → ${c.schedule.route.destination}`:"N/A",departure:c?.schedule?.departure||"N/A",seatNumber:o,fare:d,busName:c?.schedule?.bus?.name||"N/A",busLayout:c?.schedule?.bus?.layoutType||"N/A"})}ae(`Seat ${je.current?.seatNumber} has been removed from the booking.`),setTimeout(()=>ae(null),3e3)}catch(s){console.error("Error removing seat:",s),w(null)}finally{Ne(!1)}}},Qe=s=>{G(s),ee(!0)},Ve=async s=>{try{b(!0);const r=s.ticket?.ticketNumber;if(!r)throw new Error("No ticket number found for this booking");const o=(await T.getTicketByNumber(r)).data;q(o);const d=o.bookings.map(E=>E.seat?.seatNumber).filter(Boolean).join(", "),c=o.bookings.reduce((E,Ze)=>E+(Ze.payment?.amount||0),0),n=o.bookings[0];z({ticketNumber:o.ticketNumber||"N/A",qrCode:o.qrCode||"",passengerName:n?.user?.name||"N/A",passengerPhone:n?.user?.phoneNumber||n?.customerPhone||"N/A",status:n?.status||"N/A",route:n?.schedule?.route?`${n.schedule.route.origin} → ${n.schedule.route.destination}`:"N/A",departure:n?.schedule?.departure||"N/A",seatNumber:d,fare:c,busName:n?.schedule?.bus?.name||"N/A",busLayout:n?.schedule?.bus?.layoutType||"N/A"}),ce(!0)}catch(r){let a="Failed to load ticket details.";r&&typeof r=="object"&&"message"in r&&(a=r.message),k(a)}finally{b(!1)}},He=async s=>{if(s.schedule?.bus)try{b(!0);const o=(await cs.getScheduleById(s.schedule.id)).data.seats||[],d=o.filter(n=>n.isBooked).map(n=>n.seatNumber),c=o.filter(n=>!n.isBooked).map(n=>n.seatNumber);ze({busName:s.schedule.bus.name,layoutType:s.schedule.bus.layoutType||"",seatCount:s.schedule.bus.seatCount||0,bookedSeats:d,availableSeats:c,seats:o}),te(!0)}catch(r){console.error("Error fetching bus details:",r),k("Failed to load bus details. Please try again.")}finally{b(!1)}},_e=()=>{if(!t)return;const s=window.open("","_blank");if(!s)return;const r=t.qrCode||"",a=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Print Ticket</title>
        <style>
          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
          .ticket-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; }
          .ticket { background: white; width: 100%; max-width: 380px; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 188, 212, 0.15); margin: 0 auto; padding-bottom: 16px; }
          .header { background: linear-gradient(to right, #00bcd4, #00acc1); color: white; padding: 16px; text-align: center; margin-bottom: 18px; }
          .header h2 { margin: 0; font-size: 1.6rem; letter-spacing: 2px; }
          .header h3 { margin: 0; font-size: 1.1rem; font-weight: 400; letter-spacing: 1px; }
          .qr-code { text-align: center; margin: 18px 0; }
          .qr-code img { width: 120px; height: 120px; border-radius: 12px; border: 3px solid #b2ebf2; background: #fff; }
          .details { margin: 18px 0; font-size: 1rem; }
          .label { font-weight: 600; color: #0097a7; min-width: 90px; display: inline-block; }
          .info-row { margin-bottom: 8px; }
          .bus-row { margin-bottom: 8px; }
          .footer { text-align: center; color: #90a4ae; font-size: 0.9rem; margin-top: 18px; }
          @media print {
            body { margin: 0; background: #fff; }
            .ticket-container { min-height: unset; }
            .ticket { box-shadow: none; border: 2px solid #00bcd4; }
          }
        </style>
      </head>
      <body>
        <div class="ticket-container">
          <div class="ticket">
            <div class="header">
              <h2>Bus Ticket</h2>
              <h3>#${t.ticketNumber}</h3>
            </div>
            <div class="qr-code">
              ${r?`<img src="${r}" alt="QR Code" />`:'<div style="width: 120px; height: 120px; border: 2px dashed #b2ebf2; display: flex; align-items: center; justify-content: center; font-size: 13px; color: #b0bec5; border-radius: 12px;">QR Code<br/>Not Available</div>'}
              <div style="margin-top: 6px; color: #90a4ae; font-size: 0.85rem;">Scan for ticket</div>
            </div>
            <div class="details">
              <div class="info-row"><span class="label">Passenger:</span> ${t.passengerName}${t.status&&t.status!=="N/A"?` <span style='display:inline-block;padding:2px 10px;border-radius:8px;font-size:0.95em;font-weight:600;background:#e0f2f1;color:#00796b;margin-left:8px;border:1px solid #b2dfdb;'>${t.status.charAt(0)+t.status.slice(1).toLowerCase()}</span>`:""}
              </div>
              ${t.passengerPhone&&t.passengerPhone!=="N/A"?` <div class="info-row> <spanclass="label">Phone:</span> <span style='color:#00796b;font-size:0.95em;'>${t.passengerPhone}</span> </div>`:""}
              <div class="info-row"><span class="label">Route:</span> ${t.route}</div>
              <div class="info-row"><span class="label">Departure:</span> ${t.departure}</div>
              <div class="bus-row"><span class="label">Bus:</span> ${t.busName}${t.busLayout&&t.busLayout!=="N/A"?` <span style='color:#00bcd4;font-size:0.92em;'>(${t.busLayout})</span>`:""}</div>
              <div class="info-row"><span class="label">Seat${t.seatNumber.includes(",")?"s":""}:</span> ${t.seatNumber}</div>
              <div class="info-row"><span class="label">Fare:</span> Rs. ${t.fare}</div>
            </div>
            <div class="footer">Thank you for choosing Ebusewa!</div>
          </div>
        </div>
      </body>
      </html>
    `;s.document.write(a),s.document.close(),s.focus(),setTimeout(()=>s.print(),300)},We=s=>{switch(s.toUpperCase()){case"BOOKED":case"COMPLETED":return"bg-green-100 text-green-800";case"PENDING":return"bg-yellow-100 text-yellow-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},Xe=s=>Pe(new Date(s),"MMM dd, yyyy HH:mm"),Ye=s=>s.toUpperCase()!=="COMPLETED"&&s.toUpperCase()!=="CANCELLED",le=m.filter(s=>{const r=g===""||s.customerName?.toLowerCase().includes(g.toLowerCase())||s.customerPhone?.includes(g)||s.customerEmail?.toLowerCase().includes(g.toLowerCase())||s.schedule.route.origin.toLowerCase().includes(g.toLowerCase())||s.schedule.route.destination.toLowerCase().includes(g.toLowerCase()),a=p==="all"||s.status===p.toUpperCase(),o=Q===""||Pe(new Date(s.schedule.departure),"yyyy-MM-dd")===Q,d=V===""||s.ticket?.ticketNumber?.toLowerCase().includes(V.toLowerCase());return r&&a&&o&&d}),_={};le.forEach(s=>{const r=s.ticket?.ticketNumber||"NO_TICKET";_[r]||(_[r]={bookings:[]}),_[r].bookings.push(s)});const Je=Object.entries(_);return $?e.jsx(Te,{children:e.jsx(Le,{})}):e.jsx(Te,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-teal-50/30 to-cyan-50/30",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-gradient-to-r from-white via-teal-50/50 to-cyan-50/50 backdrop-blur supports-[backdrop-filter]:bg-white/80 border-b border-teal-100 shadow-sm px-4 py-4 md:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex aspect-square size-10 items-center justify-center rounded-xl bg-gradient-to-br from-teal-500 via-cyan-500 to-blue-500 text-white shadow-lg",children:e.jsx(f,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent",children:"Booking Management"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"Manage all bus bookings and tickets"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(is,{to:gs.BookingForm,children:e.jsxs(W,{className:"bg-teal-600 hover:bg-teal-700",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"New Booking"]})}),e.jsxs(W,{variant:"outline",onClick:Ue,disabled:be,className:"border-teal-200 hover:bg-teal-50",children:[e.jsx(es,{className:`h-4 w-4 mr-2 ${be?"animate-spin":""}`}),"Refresh"]})]})]})})}),e.jsxs("div",{className:"w-full max-w-7xl mx-auto p-4 md:p-6 lg:p-8",children:[ye&&e.jsx("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-[9999] w-full max-w-md",children:e.jsx(Ee,{message:ye,onDismiss:()=>ae(null)})}),U&&e.jsx(Ee,{message:U,onDismiss:()=>i(null),className:"mb-6"}),A&&e.jsx(us,{message:A,className:"mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8",children:[e.jsxs(C,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-teal-50/30 hover:shadow-2xl transition-all duration-300",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Total Bookings"}),e.jsx(f,{className:"h-4 w-4 text-teal-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-teal-600",children:O}),e.jsx("p",{className:"text-xs text-gray-500",children:"All bookings"})]})]}),e.jsxs(C,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-yellow-50/30 hover:shadow-2xl transition-all duration-300",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx(ss,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:Z}),e.jsx("p",{className:"text-xs text-gray-500",children:"Pending bookings"})]})]}),e.jsxs(C,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-green-50/30 hover:shadow-2xl transition-all duration-300",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Completed"}),e.jsx(ts,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:I}),e.jsx("p",{className:"text-xs text-gray-500",children:"Completed bookings"})]})]}),e.jsxs(C,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-red-50/30 hover:shadow-2xl transition-all duration-300",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Cancelled"}),e.jsx(as,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:y}),e.jsx("p",{className:"text-xs text-gray-500",children:"Cancelled bookings"})]})]})]}),e.jsxs(C,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-teal-50/30 mb-6 md:mb-8",children:[e.jsx(S,{className:"bg-gradient-to-r from-teal-50 to-cyan-50 rounded-t-lg",children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-teal-600"}),"Search & Filters"]})}),e.jsx(D,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"search",children:"Search Bookings"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx(re,{id:"search",placeholder:"Search by name, phone, route...",value:g,onChange:s=>$e(s.target.value),className:"pl-10 border-teal-200 focus:border-teal-500"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"status-filter",children:"Status Filter"}),e.jsxs(Ce,{value:p,onValueChange:Oe,children:[e.jsx(Se,{className:"border-teal-200 focus:border-teal-500",children:e.jsx(Be,{placeholder:"All statuses"})}),e.jsxs(De,{children:[e.jsx(u,{value:"all",children:"All Statuses"}),e.jsx(u,{value:"PENDING",children:"Pending"}),e.jsx(u,{value:"BOOKED",children:"Booked"}),e.jsx(u,{value:"COMPLETED",children:"Completed"}),e.jsx(u,{value:"CANCELLED",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"date-filter",children:"Date Filter"}),e.jsx(re,{id:"date-filter",type:"date",value:Q,onChange:s=>Ie(s.target.value),className:"border-teal-200 focus:border-teal-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"ticket-search",children:"Ticket Number"}),e.jsx(re,{id:"ticket-search",placeholder:"Search by ticket number...",value:V,onChange:s=>qe(s.target.value),className:"border-teal-200 focus:border-teal-500"})]})]})})]}),e.jsxs(C,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-teal-50/30",children:[e.jsx(S,{className:"bg-gradient-to-r from-teal-50 to-cyan-50 rounded-t-lg",children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-teal-600"}),"All Bookings (",le.length,")",p!=="all"&&e.jsx("span",{className:"ml-3 px-3 py-1 rounded-full text-xs font-semibold bg-gray-200 text-gray-700 border border-gray-300",children:p.charAt(0)+p.slice(1).toLowerCase()})]})}),e.jsx(D,{className:"p-4 md:p-6",children:$?e.jsx(Le,{rows:5}):le.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(f,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No bookings found"}),e.jsx("p",{className:"text-sm",children:g||p!=="all"||Q||V?"Try adjusting your search criteria.":"Start by creating a new booking."})]}):e.jsx("div",{className:"space-y-4",children:Je.map(([s,r])=>{const a=r.bookings[0];let o=[];return Array.isArray(a.allSeatNumbers)&&a.allSeatNumbers.length>0?o=Array.from(new Set(a.allSeatNumbers)):o=Array.from(new Set(r.bookings.map(d=>d.seat?.seatNumber).filter(d=>typeof d=="string"))),e.jsxs("div",{className:"flex flex-col p-4 border border-teal-100 rounded-lg hover:bg-teal-50/50 transition-all duration-200 gap-4",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium truncate",children:a.user?.name||a.customerName||"N/A"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",a.user?.phoneNumber||a.customerPhone||"N/A",")"]}),a.status&&e.jsx("span",{className:`ml-2 text-xs font-semibold rounded px-2 py-0.5 border ${We(a.status)}`,children:a.status.charAt(0)+a.status.slice(1).toLowerCase()})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ve,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-gray-600 truncate",children:[a.schedule.route.origin," →"," ",a.schedule.route.destination]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-500",children:Xe(a.schedule.departure)}),a.ticket?.ticketNumber&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Ticket: ",a.ticket.ticketNumber]})]})]})]}),e.jsx("div",{className:"ml-auto flex items-center",children:e.jsxs(ds,{children:[e.jsx(ms,{asChild:!0,children:e.jsx(W,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ls,{className:"h-5 w-5 text-gray-500"})})}),e.jsxs(xs,{align:"end",children:[e.jsxs(X,{onClick:()=>{G(a),se(!0)},children:[e.jsx(rs,{className:"h-4 w-4 mr-2 text-gray-500"}),"Edit Booking"]}),Ye(a.status)&&e.jsxs(X,{onClick:()=>Qe(a),children:[e.jsx(ns,{className:"h-4 w-4 mr-2 text-red-500"}),"Cancel Booking"]}),e.jsxs(X,{onClick:()=>Ve(a),children:[e.jsx(f,{className:"h-4 w-4 mr-2 text-teal-500"}),"View Ticket"]}),e.jsxs(X,{onClick:()=>He(a),children:[e.jsx(L,{className:"h-4 w-4 mr-2 text-cyan-500"}),"Bus Details"]})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"font-semibold text-teal-700",children:"Seats:"}),e.jsx("span",{className:"text-gray-800 flex flex-wrap gap-2",children:Array.isArray(o)&&o.map(d=>{const c=r.bookings.find(n=>n.seat?.seatNumber===d);return e.jsxs("span",{className:"inline-flex items-center bg-cyan-50 border border-cyan-200 rounded px-2 py-0.5 text-sm",children:[d,e.jsx("button",{className:"ml-1 text-red-500 hover:text-red-700 focus:outline-none",title:`Remove seat ${d}`,disabled:!c,onClick:()=>{c&&w({bookingId:c.id??-1,seatNumber:d})},children:"×"})]},d)})})]})]},s)})})})]}),e.jsx(P,{open:Re,onOpenChange:ee,children:e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsx(J,{children:"Cancel Booking"}),e.jsx(ne,{children:"Are you sure you want to cancel this booking? This action cannot be undone."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(N,{htmlFor:"cancel-reason",children:"Reason for Cancellation"}),e.jsx(Ae,{id:"cancel-reason",placeholder:"Enter reason for cancellation...",value:ue,onChange:s=>ge(s.target.value),className:"border-teal-200 focus:border-teal-500"})]})}),e.jsxs(M,{children:[e.jsx(F,{children:"Keep Booking"}),e.jsx(oe,{onClick:async()=>{if(K){b(!0);try{await T.adminCancelBooking(K.id,{reason:ue}),i("Booking cancelled successfully!"),await j()}catch(s){k("Failed to cancel booking. Please try again."),console.error("Error cancelling booking:",s)}finally{b(!1),ee(!1),G(null),ge("")}}},disabled:H,className:"bg-red-600 hover:bg-red-700",children:H?"Cancelling...":"Cancel Booking"})]})]})}),e.jsx(P,{open:Me,onOpenChange:se,children:e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsx(J,{children:"Update Booking Status"}),e.jsx(ne,{children:"Update the status of this booking."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"new-status",children:"New Status"}),e.jsxs(Ce,{value:de,onValueChange:me,children:[e.jsx(Se,{className:"border-teal-200 focus:border-teal-500",children:e.jsx(Be,{placeholder:"Select status"})}),e.jsxs(De,{children:[e.jsx(u,{value:"PENDING",children:"Pending"}),e.jsx(u,{value:"BOOKED",children:"Booked"}),e.jsx(u,{value:"COMPLETED",children:"Completed"}),e.jsx(u,{value:"CANCELLED",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"status-reason",children:"Reason (optional)"}),e.jsx(Ae,{id:"status-reason",placeholder:"Enter reason for status change...",value:xe,onChange:s=>he(s.target.value),className:"border-teal-200 focus:border-teal-500"})]})]}),e.jsxs(M,{children:[e.jsx(F,{children:"Cancel"}),e.jsx(oe,{onClick:Ke,disabled:H,className:"bg-teal-600 hover:bg-teal-700",children:H?"Updating...":"Update Status"})]})]})}),e.jsx(P,{open:ie,onOpenChange:ce,children:e.jsxs(R,{className:"max-w-lg p-0 bg-gradient-to-br from-cyan-50 via-teal-100 to-blue-50 border-0 shadow-2xl",children:[e.jsxs("div",{className:"rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-teal-600 to-cyan-500 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-white font-bold text-lg flex items-center gap-2",children:[e.jsx(f,{className:"h-6 w-6"})," Ticket"]}),e.jsxs("div",{className:"text-white text-xs font-mono tracking-widest",children:["#",t?.ticketNumber]})]}),t&&e.jsxs("div",{className:"p-6 flex flex-col md:flex-row gap-6 items-center md:items-start bg-white/80",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[t.qrCode?e.jsx("img",{src:t.qrCode,alt:"QR Code",className:"w-36 h-36 rounded-xl border-4 border-cyan-200 shadow-lg bg-white",onError:s=>{s.currentTarget.src="",s.currentTarget.alt="QR Not Available"}}):e.jsx("div",{className:"w-36 h-36 flex items-center justify-center rounded-xl border-4 border-dashed border-cyan-200 bg-cyan-50 text-cyan-400 text-center text-xs font-semibold",children:"QR Code Not Available"}),e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Scan for ticket"})]}),e.jsxs("div",{className:"flex-1 w-full space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-teal-700",children:"Passenger:"}),e.jsx("span",{className:"text-gray-800",children:t.passengerName}),t.passengerPhone&&t.passengerPhone!=="N/A"&&e.jsx("span",{className:"ml-2 text-xs text-cyan-700 bg-cyan-100 rounded px-2 py-0.5",children:t.passengerPhone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Route:"}),e.jsx("span",{className:"text-gray-800",children:t.route})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Departure:"}),e.jsx("span",{className:"text-gray-800",children:t.departure})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Bus:"}),e.jsx("span",{className:"text-gray-800",children:t.busName}),t.busLayout&&t.busLayout!=="N/A"&&e.jsx("span",{className:"ml-2 text-xs text-cyan-700 bg-cyan-100 rounded px-2 py-0.5",children:t.busLayout})]}),!(h&&h.bookings&&h.bookings.length>0)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Seat:"}),e.jsx("span",{className:"text-gray-800",children:t.seatNumbers})]}),h&&h.bookings&&h.bookings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(L,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Seats:"}),e.jsx("span",{className:"text-gray-800 flex flex-wrap gap-2",children:h.bookings.map(s=>s.seat?.seatNumber).filter(s=>typeof s=="string").map(s=>{const r=h.bookings.find(a=>a.seat?.seatNumber===s);return e.jsxs("span",{className:"inline-flex items-center bg-cyan-50 border border-cyan-200 rounded px-2 py-0.5 text-sm",children:[s,e.jsx("button",{className:"ml-1 text-red-500 hover:text-red-700 focus:outline-none",title:`Remove seat ${s}`,disabled:!r,onClick:()=>{r&&w({bookingId:r.id??-1,seatNumber:s})},children:"×"})]},s)})})]})]})]})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex w-full gap-2 justify-end",children:[e.jsxs(W,{variant:"outline",onClick:_e,className:"border-cyan-400 text-cyan-700 hover:bg-cyan-50",children:[e.jsx(os,{className:"h-4 w-4 mr-2"})," Print"]}),e.jsx(F,{children:"Close"})]})})]})}),e.jsx(P,{open:Fe,onOpenChange:te,children:e.jsxs(R,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-teal-600"}),"Bus Details - ",x?.busName]})}),x&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Layout Type"}),e.jsx("div",{className:"font-semibold text-teal-700",children:x.layoutType})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Seats"}),e.jsx("div",{className:"font-semibold text-teal-700",children:x.seatCount})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Available"}),e.jsx("div",{className:"font-semibold text-green-600",children:x.availableSeats.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Booked"}),e.jsx("div",{className:"font-semibold text-red-600",children:x.bookedSeats.length})]}),e.jsxs("div",{className:"text-center col-span-2 md:col-span-1",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Occupancy"}),e.jsxs("div",{className:"font-semibold text-blue-600",children:[Math.round(x.bookedSeats.length/x.seatCount*100),"%"]})]})]}),x.bookedSeats.length>0&&e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-semibold text-red-700 mb-2",children:"Booked Seats:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.bookedSeats.map(s=>e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-medium",children:s},s))})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold text-teal-700 mb-3 text-center",children:"Seat Layout"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(hs,{seats:x.seats||[],layoutType:x.layoutType,busName:x.busName,onSeatClick:()=>{},showLegend:!0,compact:!0})})]})]}),e.jsx(M,{className:"flex justify-end",children:e.jsx(F,{onClick:()=>te(!1),children:"Close"})})]})}),e.jsx(P,{open:!!v,onOpenChange:s=>!s&&w(null),children:e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsx(J,{children:"Remove Seat"}),e.jsxs(ne,{children:["Are you sure you want to remove seat"," ",v?.seatNumber," from this booking? This action cannot be undone."]})]}),e.jsxs(M,{children:[e.jsx(F,{onClick:()=>w(null),children:"Cancel"}),e.jsx(oe,{onClick:Ge,disabled:fe,className:"bg-red-600 hover:bg-red-700",children:fe?"Removing...":"Remove Seat"})]})]})})]})]})})}export{Es as BookingList};
