import{j as e,T,R as ds,d as ms,e as xs,f as hs,S as Be,M as Re,g as Me,o as us,p as gs,q as bs,B as z,P as ps}from"./ui-vendor-DMBPzNwu.js";import{r as l,L as Ns}from"./react-vendor-C8rorRqO.js";import{b as I,B as le,C as M,a as F,c as $,d as O,I as ge,s as fs}from"./api-C7d73vgv.js";import{S as Fe,a as $e,b as Oe,c as Ie,d as y}from"./select-D3T-VKQN.js";import{A as qe,D as js,g as ys,h as ws,i as re,a as U,b as K,c as ne,d as oe,j as be,e as G,f as Q,k as pe}from"./AdminLayout-lzRtiUax.js";import{T as ze}from"./textarea-ZISeY5eG.js";import{B as vs}from"./bus-seat-layout-Q92fS2Nq.js";import{S as Ue,E as ks}from"./success-message-BsusCHyT.js";import{R as Cs}from"./index-DnDBnOSx.js";import{L as E}from"./label-CZBUESOW.js";import{T as Ke}from"./skeleton-jijkxZMJ.js";import{f as Ge}from"./utils-vendor-BIYRr1x_.js";import"./badge-BRWl9YMx.js";import"./query-vendor-Dv9SXHgC.js";function Ss(){const[m,V]=l.useState([]),[L,H]=l.useState(!0),[ce,_]=l.useState(null),P=l.useCallback(async()=>{try{H(!0),_(null);const i=await I.getAllBookings({page:1,limit:1e3});V(i.data.bookings||i.data)}catch(i){let q="Failed to fetch bookings";i instanceof Error&&(q=i.message),_(q)}finally{H(!1)}},[]);l.useEffect(()=>{P()},[P]);const N=l.useMemo(()=>m.length,[m]),W=l.useMemo(()=>m.filter(i=>i.status==="BOOKED").length,[m]),t=l.useMemo(()=>m.filter(i=>i.status==="COMPLETED").length,[m]),X=l.useMemo(()=>m.filter(i=>i.status==="CANCELLED").length,[m]),Y=l.useCallback(async()=>{await P()},[P]);return{bookings:m,loading:L,error:ce,refreshBookings:Y,totalBookings:N,pendingBookings:W,completedBookings:t,cancelledBookings:X}}function zs(){const{bookings:m,loading:V,refreshBookings:L}=Ss(),H=m.length,ce=m.filter(s=>s.status==="PENDING").length,_=m.filter(s=>s.status==="COMPLETED").length,P=m.filter(s=>s.status==="CANCELLED").length,[N,W]=l.useState(null),[t,X]=l.useState(null),[Y,i]=l.useState(null),[q,B]=l.useState(null),[Qe,ie]=l.useState(!1),[Ve,de]=l.useState(!1),[Ne,fe]=l.useState(!1),[He,me]=l.useState(!1),[J,Z]=l.useState(null),[je,ye]=l.useState(""),[we,ve]=l.useState(""),[ke,Ce]=l.useState(""),[Se,De]=l.useState(!1),[w,_e]=l.useState(""),[D,We]=l.useState("all"),[ee,Xe]=l.useState(""),[se,Ye]=l.useState(""),[te,v]=l.useState(!1),[Ae,Te]=l.useState(!1),[x,Je]=l.useState(null),[k,R]=l.useState(null),Ee=l.useRef(null),[Le,xe]=l.useState(null),Ze=async()=>{De(!0);try{await L(),i("Bookings refreshed successfully!"),setTimeout(()=>{i(null)},3e3)}catch{B("Failed to refresh bookings.")}finally{De(!1)}},es=async()=>{if(J){v(!0);try{B(null),await I.updateBookingStatus(J.id,{status:je,reason:we}),i("Booking status updated successfully!"),de(!1),Z(null),ye(""),ve(""),await L(),setTimeout(()=>{i(null)},3e3)}catch(s){let r="Failed to update booking  status.";s&&typeof s=="object"&&"message"in s&&(r=s.message),B(r)}finally{v(!1)}}},ss=async()=>{var s,r,a,d,u,g,b,c,h;if(k){Ee.current=k,Te(!0);try{const f=await I.removeSeatFromBooking(k.bookingId,k.seatNumber);if(R(null),await L(),Ne&&(t!=null&&t.ticketNumber)){const j=(await I.getTicketByNumber(t.ticketNumber)).data;W(j);const C=j.bookings.map(n=>{var S;return(S=n.seat)==null?void 0:S.seatNumber}).filter(Boolean).join(", "),ue=j.bookings.reduce((n,S)=>{var A;return n+(((A=S.payment)==null?void 0:A.amount)||0)},0),o=j.bookings[0];X({ticketNumber:j.ticketNumber||"N/A",qrCode:j.qrCode||"",passengerName:((s=o==null?void 0:o.user)==null?void 0:s.name)||"N/A",passengerPhone:((r=o==null?void 0:o.user)==null?void 0:r.phoneNumber)||(o==null?void 0:o.customerPhone)||"N/A",status:(o==null?void 0:o.status)||"N/A",route:(a=o==null?void 0:o.schedule)!=null&&a.route?`${o.schedule.route.origin} → ${o.schedule.route.destination}`:"N/A",departure:((d=o==null?void 0:o.schedule)==null?void 0:d.departure)||"N/A",seatNumber:C,fare:ue,busName:((g=(u=o==null?void 0:o.schedule)==null?void 0:u.bus)==null?void 0:g.name)||"N/A",busLayout:((c=(b=o==null?void 0:o.schedule)==null?void 0:b.bus)==null?void 0:c.layoutType)||"N/A"})}xe(`Seat ${(h=Ee.current)==null?void 0:h.seatNumber} has been removed from the booking.`),setTimeout(()=>xe(null),3e3)}catch(f){console.error("Error removing seat:",f),R(null)}finally{Te(!1)}}},ts=s=>{Z(s),ie(!0)},as=async s=>{var r,a,d,u,g,b,c,h,f;try{v(!0);const p=(r=s.ticket)==null?void 0:r.ticketNumber;if(!p)throw new Error("No ticket number found for this booking");const C=(await I.getTicketByNumber(p)).data;W(C);const ue=C.bookings.map(S=>{var A;return(A=S.seat)==null?void 0:A.seatNumber}).filter(Boolean).join(", "),o=C.bookings.reduce((S,A)=>{var Pe;return S+(((Pe=A.payment)==null?void 0:Pe.amount)||0)},0),n=C.bookings[0];X({ticketNumber:C.ticketNumber||"N/A",qrCode:C.qrCode||"",passengerName:((a=n==null?void 0:n.user)==null?void 0:a.name)||"N/A",passengerPhone:((d=n==null?void 0:n.user)==null?void 0:d.phoneNumber)||(n==null?void 0:n.customerPhone)||"N/A",status:(n==null?void 0:n.status)||"N/A",route:(u=n==null?void 0:n.schedule)!=null&&u.route?`${n.schedule.route.origin} → ${n.schedule.route.destination}`:"N/A",departure:((g=n==null?void 0:n.schedule)==null?void 0:g.departure)||"N/A",seatNumber:ue,fare:o,busName:((c=(b=n==null?void 0:n.schedule)==null?void 0:b.bus)==null?void 0:c.name)||"N/A",busLayout:((f=(h=n==null?void 0:n.schedule)==null?void 0:h.bus)==null?void 0:f.layoutType)||"N/A"}),fe(!0)}catch(p){let j="Failed to load ticket details.";p&&typeof p=="object"&&"message"in p&&(j=p.message),B(j)}finally{v(!1)}},ls=async s=>{var r;if((r=s.schedule)!=null&&r.bus)try{v(!0);const u=(await fs.getScheduleById(s.schedule.id)).data.seats||[],g=u.filter(c=>c.isBooked).map(c=>c.seatNumber),b=u.filter(c=>!c.isBooked).map(c=>c.seatNumber);Je({busName:s.schedule.bus.name,layoutType:s.schedule.bus.layoutType||"",seatCount:s.schedule.bus.seatCount||0,bookedSeats:g,availableSeats:b,seats:u}),me(!0)}catch(a){console.error("Error fetching bus details:",a),B("Failed to load bus details. Please try again.")}finally{v(!1)}},rs=()=>{if(!t)return;const s=window.open("","_blank");if(!s)return;const r=t.qrCode||"",a=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Print Ticket</title>
        <style>
          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
          .ticket-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; }
          .ticket { background: white; width: 100%; max-width: 380px; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 188, 212, 0.15); margin: 0 auto; padding-bottom: 16px; }
          .header { background: linear-gradient(to right, #00bcd4, #00acc1); color: white; padding: 16px; text-align: center; margin-bottom: 18px; }
          .header h2 { margin: 0; font-size: 1.6rem; letter-spacing: 2px; }
          .header h3 { margin: 0; font-size: 1.1rem; font-weight: 400; letter-spacing: 1px; }
          .qr-code { text-align: center; margin: 18px 0; }
          .qr-code img { width: 120px; height: 120px; border-radius: 12px; border: 3px solid #b2ebf2; background: #fff; }
          .details { margin: 18px 0; font-size: 1rem; }
          .label { font-weight: 600; color: #0097a7; min-width: 90px; display: inline-block; }
          .info-row { margin-bottom: 8px; }
          .bus-row { margin-bottom: 8px; }
          .footer { text-align: center; color: #90a4ae; font-size: 0.9rem; margin-top: 18px; }
          @media print {
            body { margin: 0; background: #fff; }
            .ticket-container { min-height: unset; }
            .ticket { box-shadow: none; border: 2px solid #00bcd4; }
          }
        </style>
      </head>
      <body>
        <div class="ticket-container">
          <div class="ticket">
            <div class="header">
              <h2>Bus Ticket</h2>
              <h3>#${t.ticketNumber}</h3>
            </div>
            <div class="qr-code">
              ${r?`<img src="${r}" alt="QR Code" />`:'<div style="width: 120px; height: 120px; border: 2px dashed #b2ebf2; display: flex; align-items: center; justify-content: center; font-size: 13px; color: #b0bec5; border-radius: 12px;">QR Code<br/>Not Available</div>'}
              <div style="margin-top: 6px; color: #90a4ae; font-size: 0.85rem;">Scan for ticket</div>
            </div>
            <div class="details">
              <div class="info-row"><span class="label">Passenger:</span> ${t.passengerName}${t.status&&t.status!=="N/A"?` <span style='display:inline-block;padding:2px 10px;border-radius:8px;font-size:0.95em;font-weight:600;background:#e0f2f1;color:#00796b;margin-left:8px;border:1px solid #b2dfdb;'>${t.status.charAt(0)+t.status.slice(1).toLowerCase()}</span>`:""}
              </div>
              ${t.passengerPhone&&t.passengerPhone!=="N/A"?` <div class="info-row> <spanclass="label">Phone:</span> <span style='color:#00796b;font-size:0.95em;'>${t.passengerPhone}</span> </div>`:""}
              <div class="info-row"><span class="label">Route:</span> ${t.route}</div>
              <div class="info-row"><span class="label">Departure:</span> ${t.departure}</div>
              <div class="bus-row"><span class="label">Bus:</span> ${t.busName}${t.busLayout&&t.busLayout!=="N/A"?` <span style='color:#00bcd4;font-size:0.92em;'>(${t.busLayout})</span>`:""}</div>
              <div class="info-row"><span class="label">Seat${t.seatNumber.includes(",")?"s":""}:</span> ${t.seatNumber}</div>
              <div class="info-row"><span class="label">Fare:</span> Rs. ${t.fare}</div>
            </div>
            <div class="footer">Thank you for choosing Ebusewa!</div>
          </div>
        </div>
      </body>
      </html>
    `;s.document.write(a),s.document.close(),s.focus(),setTimeout(()=>s.print(),300)},ns=s=>{switch(s.toUpperCase()){case"BOOKED":case"COMPLETED":return"bg-green-100 text-green-800";case"PENDING":return"bg-yellow-100 text-yellow-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},os=s=>Ge(new Date(s),"MMM dd, yyyy HH:mm"),cs=s=>s.toUpperCase()!=="COMPLETED"&&s.toUpperCase()!=="CANCELLED",he=m.filter(s=>{var g,b,c,h,f;const r=w===""||((g=s.customerName)==null?void 0:g.toLowerCase().includes(w.toLowerCase()))||((b=s.customerPhone)==null?void 0:b.includes(w))||((c=s.customerEmail)==null?void 0:c.toLowerCase().includes(w.toLowerCase()))||s.schedule.route.origin.toLowerCase().includes(w.toLowerCase())||s.schedule.route.destination.toLowerCase().includes(w.toLowerCase()),a=D==="all"||s.status===D.toUpperCase(),d=ee===""||Ge(new Date(s.schedule.departure),"yyyy-MM-dd")===ee,u=se===""||((f=(h=s.ticket)==null?void 0:h.ticketNumber)==null?void 0:f.toLowerCase().includes(se.toLowerCase()));return r&&a&&d&&u}),ae={};he.forEach(s=>{var a;const r=((a=s.ticket)==null?void 0:a.ticketNumber)||"NO_TICKET";ae[r]||(ae[r]={bookings:[]}),ae[r].bookings.push(s)});const is=Object.entries(ae);return V?e.jsx(qe,{children:e.jsx(Ke,{})}):e.jsx(qe,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-teal-50/30 to-cyan-50/30",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-gradient-to-r from-white via-teal-50/50 to-cyan-50/50 backdrop-blur supports-[backdrop-filter]:bg-white/80 border-b border-teal-100 shadow-sm px-4 py-4 md:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex aspect-square size-10 items-center justify-center rounded-xl bg-gradient-to-br from-teal-500 via-cyan-500 to-blue-500 text-white shadow-lg",children:e.jsx(T,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent",children:"Booking Management"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"Manage all bus bookings and tickets"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(Ns,{to:Cs.BookingForm,children:e.jsxs(le,{className:"bg-teal-600 hover:bg-teal-700",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"New Booking"]})}),e.jsxs(le,{variant:"outline",onClick:Ze,disabled:Se,className:"border-teal-200 hover:bg-teal-50",children:[e.jsx(ds,{className:`h-4 w-4 mr-2 ${Se?"animate-spin":""}`}),"Refresh"]})]})]})})}),e.jsxs("div",{className:"w-full max-w-7xl mx-auto p-4 md:p-6 lg:p-8",children:[Le&&e.jsx("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-[9999] w-full max-w-md",children:e.jsx(Ue,{message:Le,onDismiss:()=>xe(null)})}),Y&&e.jsx(Ue,{message:Y,onDismiss:()=>i(null),className:"mb-6"}),q&&e.jsx(ks,{message:q,className:"mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8",children:[e.jsxs(M,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-teal-50/30 hover:shadow-2xl transition-all duration-300",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium text-gray-600",children:"Total Bookings"}),e.jsx(T,{className:"h-4 w-4 text-teal-600"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold text-teal-600",children:H}),e.jsx("p",{className:"text-xs text-gray-500",children:"All bookings"})]})]}),e.jsxs(M,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-yellow-50/30 hover:shadow-2xl transition-all duration-300",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx(ms,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:ce}),e.jsx("p",{className:"text-xs text-gray-500",children:"Pending bookings"})]})]}),e.jsxs(M,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-green-50/30 hover:shadow-2xl transition-all duration-300",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium text-gray-600",children:"Completed"}),e.jsx(xs,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:_}),e.jsx("p",{className:"text-xs text-gray-500",children:"Completed bookings"})]})]}),e.jsxs(M,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-red-50/30 hover:shadow-2xl transition-all duration-300",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium text-gray-600",children:"Cancelled"}),e.jsx(hs,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:P}),e.jsx("p",{className:"text-xs text-gray-500",children:"Cancelled bookings"})]})]})]}),e.jsxs(M,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-teal-50/30 mb-6 md:mb-8",children:[e.jsx(F,{className:"bg-gradient-to-r from-teal-50 to-cyan-50 rounded-t-lg",children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-teal-600"}),"Search & Filters"]})}),e.jsx(O,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"search",children:"Search Bookings"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx(ge,{id:"search",placeholder:"Search by name, phone, route...",value:w,onChange:s=>_e(s.target.value),className:"pl-10 border-teal-200 focus:border-teal-500"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"status-filter",children:"Status Filter"}),e.jsxs(Fe,{value:D,onValueChange:We,children:[e.jsx($e,{className:"border-teal-200 focus:border-teal-500",children:e.jsx(Oe,{placeholder:"All statuses"})}),e.jsxs(Ie,{children:[e.jsx(y,{value:"all",children:"All Statuses"}),e.jsx(y,{value:"PENDING",children:"Pending"}),e.jsx(y,{value:"BOOKED",children:"Booked"}),e.jsx(y,{value:"COMPLETED",children:"Completed"}),e.jsx(y,{value:"CANCELLED",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"date-filter",children:"Date Filter"}),e.jsx(ge,{id:"date-filter",type:"date",value:ee,onChange:s=>Xe(s.target.value),className:"border-teal-200 focus:border-teal-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"ticket-search",children:"Ticket Number"}),e.jsx(ge,{id:"ticket-search",placeholder:"Search by ticket number...",value:se,onChange:s=>Ye(s.target.value),className:"border-teal-200 focus:border-teal-500"})]})]})})]}),e.jsxs(M,{className:"shadow-xl border-0 bg-gradient-to-br from-white to-teal-50/30",children:[e.jsx(F,{className:"bg-gradient-to-r from-teal-50 to-cyan-50 rounded-t-lg",children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5 text-teal-600"}),"All Bookings (",he.length,")",D!=="all"&&e.jsx("span",{className:"ml-3 px-3 py-1 rounded-full text-xs font-semibold bg-gray-200 text-gray-700 border border-gray-300",children:D.charAt(0)+D.slice(1).toLowerCase()})]})}),e.jsx(O,{className:"p-4 md:p-6",children:V?e.jsx(Ke,{rows:5}):he.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No bookings found"}),e.jsx("p",{className:"text-sm",children:w||D!=="all"||ee||se?"Try adjusting your search criteria.":"Start by creating a new booking."})]}):e.jsx("div",{className:"space-y-4",children:is.map(([s,r])=>{var u,g,b;const a=r.bookings[0];let d=[];return Array.isArray(a.allSeatNumbers)&&a.allSeatNumbers.length>0?d=Array.from(new Set(a.allSeatNumbers)):d=Array.from(new Set(r.bookings.map(c=>{var h;return(h=c.seat)==null?void 0:h.seatNumber}).filter(c=>typeof c=="string"))),e.jsxs("div",{className:"flex flex-col p-4 border border-teal-100 rounded-lg hover:bg-teal-50/50 transition-all duration-200 gap-4",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium truncate",children:((u=a.user)==null?void 0:u.name)||a.customerName||"N/A"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",((g=a.user)==null?void 0:g.phoneNumber)||a.customerPhone||"N/A",")"]}),a.status&&e.jsx("span",{className:`ml-2 text-xs font-semibold rounded px-2 py-0.5 border ${ns(a.status)}`,children:a.status.charAt(0)+a.status.slice(1).toLowerCase()})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Re,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-gray-600 truncate",children:[a.schedule.route.origin," →"," ",a.schedule.route.destination]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-500",children:os(a.schedule.departure)}),((b=a.ticket)==null?void 0:b.ticketNumber)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Ticket: ",a.ticket.ticketNumber]})]})]})]}),e.jsx("div",{className:"ml-auto flex items-center",children:e.jsxs(js,{children:[e.jsx(ys,{asChild:!0,children:e.jsx(le,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(us,{className:"h-5 w-5 text-gray-500"})})}),e.jsxs(ws,{align:"end",children:[e.jsxs(re,{onClick:()=>{Z(a),de(!0)},children:[e.jsx(gs,{className:"h-4 w-4 mr-2 text-gray-500"}),"Edit Booking"]}),cs(a.status)&&e.jsxs(re,{onClick:()=>ts(a),children:[e.jsx(bs,{className:"h-4 w-4 mr-2 text-red-500"}),"Cancel Booking"]}),e.jsxs(re,{onClick:()=>as(a),children:[e.jsx(T,{className:"h-4 w-4 mr-2 text-teal-500"}),"View Ticket"]}),e.jsxs(re,{onClick:()=>ls(a),children:[e.jsx(z,{className:"h-4 w-4 mr-2 text-cyan-500"}),"Bus Details"]})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"font-semibold text-teal-700",children:"Seats:"}),e.jsx("span",{className:"text-gray-800 flex flex-wrap gap-2",children:Array.isArray(d)&&d.map(c=>{const h=r.bookings.find(f=>{var p;return((p=f.seat)==null?void 0:p.seatNumber)===c});return e.jsxs("span",{className:"inline-flex items-center bg-cyan-50 border border-cyan-200 rounded px-2 py-0.5 text-sm",children:[c,e.jsx("button",{className:"ml-1 text-red-500 hover:text-red-700 focus:outline-none",title:`Remove seat ${c}`,disabled:!h,onClick:()=>{h&&R({bookingId:h.id??-1,seatNumber:c})},children:"×"})]},c)})})]})]},s)})})})]}),e.jsx(U,{open:Qe,onOpenChange:ie,children:e.jsxs(K,{children:[e.jsxs(ne,{children:[e.jsx(oe,{children:"Cancel Booking"}),e.jsx(be,{children:"Are you sure you want to cancel this booking? This action cannot be undone."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(E,{htmlFor:"cancel-reason",children:"Reason for Cancellation"}),e.jsx(ze,{id:"cancel-reason",placeholder:"Enter reason for cancellation...",value:ke,onChange:s=>Ce(s.target.value),className:"border-teal-200 focus:border-teal-500"})]})}),e.jsxs(G,{children:[e.jsx(Q,{children:"Keep Booking"}),e.jsx(pe,{onClick:async()=>{if(J){v(!0);try{await I.adminCancelBooking(J.id,{reason:ke}),i("Booking cancelled successfully!"),await L()}catch(s){B("Failed to cancel booking. Please try again."),console.error("Error cancelling booking:",s)}finally{v(!1),ie(!1),Z(null),Ce("")}}},disabled:te,className:"bg-red-600 hover:bg-red-700",children:te?"Cancelling...":"Cancel Booking"})]})]})}),e.jsx(U,{open:Ve,onOpenChange:de,children:e.jsxs(K,{children:[e.jsxs(ne,{children:[e.jsx(oe,{children:"Update Booking Status"}),e.jsx(be,{children:"Update the status of this booking."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"new-status",children:"New Status"}),e.jsxs(Fe,{value:je,onValueChange:ye,children:[e.jsx($e,{className:"border-teal-200 focus:border-teal-500",children:e.jsx(Oe,{placeholder:"Select status"})}),e.jsxs(Ie,{children:[e.jsx(y,{value:"PENDING",children:"Pending"}),e.jsx(y,{value:"BOOKED",children:"Booked"}),e.jsx(y,{value:"COMPLETED",children:"Completed"}),e.jsx(y,{value:"CANCELLED",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"status-reason",children:"Reason (optional)"}),e.jsx(ze,{id:"status-reason",placeholder:"Enter reason for status change...",value:we,onChange:s=>ve(s.target.value),className:"border-teal-200 focus:border-teal-500"})]})]}),e.jsxs(G,{children:[e.jsx(Q,{children:"Cancel"}),e.jsx(pe,{onClick:es,disabled:te,className:"bg-teal-600 hover:bg-teal-700",children:te?"Updating...":"Update Status"})]})]})}),e.jsx(U,{open:Ne,onOpenChange:fe,children:e.jsxs(K,{className:"max-w-lg p-0 bg-gradient-to-br from-cyan-50 via-teal-100 to-blue-50 border-0 shadow-2xl",children:[e.jsxs("div",{className:"rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-teal-600 to-cyan-500 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-white font-bold text-lg flex items-center gap-2",children:[e.jsx(T,{className:"h-6 w-6"})," Ticket"]}),e.jsxs("div",{className:"text-white text-xs font-mono tracking-widest",children:["#",t==null?void 0:t.ticketNumber]})]}),t&&e.jsxs("div",{className:"p-6 flex flex-col md:flex-row gap-6 items-center md:items-start bg-white/80",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[t.qrCode?e.jsx("img",{src:t.qrCode,alt:"QR Code",className:"w-36 h-36 rounded-xl border-4 border-cyan-200 shadow-lg bg-white",onError:s=>{s.currentTarget.src="",s.currentTarget.alt="QR Not Available"}}):e.jsx("div",{className:"w-36 h-36 flex items-center justify-center rounded-xl border-4 border-dashed border-cyan-200 bg-cyan-50 text-cyan-400 text-center text-xs font-semibold",children:"QR Code Not Available"}),e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Scan for ticket"})]}),e.jsxs("div",{className:"flex-1 w-full space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-teal-700",children:"Passenger:"}),e.jsx("span",{className:"text-gray-800",children:t.passengerName}),t.passengerPhone&&t.passengerPhone!=="N/A"&&e.jsx("span",{className:"ml-2 text-xs text-cyan-700 bg-cyan-100 rounded px-2 py-0.5",children:t.passengerPhone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Route:"}),e.jsx("span",{className:"text-gray-800",children:t.route})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Departure:"}),e.jsx("span",{className:"text-gray-800",children:t.departure})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Bus:"}),e.jsx("span",{className:"text-gray-800",children:t.busName}),t.busLayout&&t.busLayout!=="N/A"&&e.jsx("span",{className:"ml-2 text-xs text-cyan-700 bg-cyan-100 rounded px-2 py-0.5",children:t.busLayout})]}),!(N&&N.bookings&&N.bookings.length>0)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Seat:"}),e.jsx("span",{className:"text-gray-800",children:t.seatNumbers})]}),N&&N.bookings&&N.bookings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(z,{className:"h-4 w-4 text-cyan-500"}),e.jsx("span",{className:"font-semibold text-teal-700",children:"Seats:"}),e.jsx("span",{className:"text-gray-800 flex flex-wrap gap-2",children:N.bookings.map(s=>{var r;return(r=s.seat)==null?void 0:r.seatNumber}).filter(s=>typeof s=="string").map(s=>{const r=N.bookings.find(a=>{var d;return((d=a.seat)==null?void 0:d.seatNumber)===s});return e.jsxs("span",{className:"inline-flex items-center bg-cyan-50 border border-cyan-200 rounded px-2 py-0.5 text-sm",children:[s,e.jsx("button",{className:"ml-1 text-red-500 hover:text-red-700 focus:outline-none",title:`Remove seat ${s}`,disabled:!r,onClick:()=>{r&&R({bookingId:r.id??-1,seatNumber:s})},children:"×"})]},s)})})]})]})]})]}),e.jsx(G,{children:e.jsxs("div",{className:"flex w-full gap-2 justify-end",children:[e.jsxs(le,{variant:"outline",onClick:rs,className:"border-cyan-400 text-cyan-700 hover:bg-cyan-50",children:[e.jsx(ps,{className:"h-4 w-4 mr-2"})," Print"]}),e.jsx(Q,{children:"Close"})]})})]})}),e.jsx(U,{open:He,onOpenChange:me,children:e.jsxs(K,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ne,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-teal-600"}),"Bus Details - ",x==null?void 0:x.busName]})}),x&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Layout Type"}),e.jsx("div",{className:"font-semibold text-teal-700",children:x.layoutType})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Seats"}),e.jsx("div",{className:"font-semibold text-teal-700",children:x.seatCount})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Available"}),e.jsx("div",{className:"font-semibold text-green-600",children:x.availableSeats.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Booked"}),e.jsx("div",{className:"font-semibold text-red-600",children:x.bookedSeats.length})]}),e.jsxs("div",{className:"text-center col-span-2 md:col-span-1",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Occupancy"}),e.jsxs("div",{className:"font-semibold text-blue-600",children:[Math.round(x.bookedSeats.length/x.seatCount*100),"%"]})]})]}),x.bookedSeats.length>0&&e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-semibold text-red-700 mb-2",children:"Booked Seats:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.bookedSeats.map(s=>e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-medium",children:s},s))})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold text-teal-700 mb-3 text-center",children:"Seat Layout"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(vs,{seats:x.seats||[],layoutType:x.layoutType,busName:x.busName,onSeatClick:()=>{},showLegend:!0,compact:!0})})]})]}),e.jsx(G,{className:"flex justify-end",children:e.jsx(Q,{onClick:()=>me(!1),children:"Close"})})]})}),e.jsx(U,{open:!!k,onOpenChange:s=>!s&&R(null),children:e.jsxs(K,{children:[e.jsxs(ne,{children:[e.jsx(oe,{children:"Remove Seat"}),e.jsxs(be,{children:["Are you sure you want to remove seat"," ",k==null?void 0:k.seatNumber," from this booking? This action cannot be undone."]})]}),e.jsxs(G,{children:[e.jsx(Q,{onClick:()=>R(null),children:"Cancel"}),e.jsx(pe,{onClick:ss,disabled:Ae,className:"bg-red-600 hover:bg-red-700",children:Ae?"Removing...":"Remove Seat"})]})]})})]})]})})}export{zs as BookingList};
