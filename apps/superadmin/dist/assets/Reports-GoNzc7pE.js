import{j as e,am as d,an as $,ao as c,ap as x,aq as h,ar as m,as as u,at as G,au as M,av as B}from"./ui-vendor-BPnJF_7J.js";import{C as j,a as p,b,d as g}from"./card-CoINBLpb.js";import{B as l}from"./index-C5bx2-Fn.js";import{T as E}from"./table-mXJe5lnO.js";import{S as X}from"./skeleton-BmX8kKu8.js";import{E as Y}from"./error-message-yDPqqqhZ.js";import{r}from"./react-vendor-Bgq3EpD8.js";import{s as q}from"./superadminApi-Bft6DRZm.js";import"./query-vendor-B3bfG-l7.js";import"./utils-vendor-Dq7h7Pqt.js";const J=()=>{const[s,O]=r.useState(null),[T,L]=r.useState(!1),[W,w]=r.useState(null),[y,D]=r.useState([]),[n,_]=r.useState([]),[o,k]=r.useState({dateFrom:"",dateTo:"",routeId:"",busId:""}),f=r.useCallback(()=>{L(!0),w(null),q.getSummaryReport({params:{...o.dateFrom&&{dateFrom:o.dateFrom},...o.dateTo&&{dateTo:o.dateTo},...o.routeId&&{routeId:o.routeId},...o.busId&&{busId:o.busId}}}).then(a=>O(a.data)).catch(a=>w(a instanceof Error?a.message:"Failed to load report")).finally(()=>L(!1))},[o]),R=r.useCallback(async()=>{try{const[a,i]=await Promise.all([q.getAllRoutes(),q.getAllBuses()]);D(a.data),_(i.data)}catch(a){console.error("Failed to fetch routes and buses:",a)}},[]),F=r.useCallback((a,i)=>{k(v=>({...v,[a]:i}))},[]),U=r.useCallback(()=>{k({dateFrom:"",dateTo:"",routeId:"",busId:""})},[]),I=r.useCallback((a,i,v)=>{const K=[i.join(",")].concat(a.map(P=>i.map(V=>String(P[V]??"")).join(","))).join(`
`),A=new Blob([K],{type:"text/csv"}),C=URL.createObjectURL(A),N=document.createElement("a");N.href=C,N.download=v,N.click(),URL.revokeObjectURL(C)},[]);return r.useEffect(()=>{R()},[R]),r.useEffect(()=>{f()},[f]),{report:s,loading:T,error:W,routes:y,buses:n,filters:o,updateFilter:F,clearFilters:U,fetchReport:f,downloadCSV:I}},ie=()=>{var _,o,k,f,R,F,U,I,a,i,v,K,A,C,N,P,V,H;const{report:s,loading:O,error:T,routes:L,buses:W,filters:w,updateFilter:y,fetchReport:D,downloadCSV:n}=J();return e.jsx("div",{className:"w-full min-h-screen bg-gradient-to-br from-white to-teal-50",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Reports"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-2 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Date From"}),e.jsx("input",{type:"date",value:w.dateFrom,onChange:t=>y("dateFrom",t.target.value),className:"border rounded px-2 py-1 w-full sm:w-auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Date To"}),e.jsx("input",{type:"date",value:w.dateTo,onChange:t=>y("dateTo",t.target.value),className:"border rounded px-2 py-1 w-full sm:w-auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Route"}),e.jsxs("select",{value:w.routeId,onChange:t=>y("routeId",t.target.value),className:"border rounded px-2 py-1 w-full sm:w-auto",children:[e.jsx("option",{value:"",children:"All"}),L.map(t=>e.jsx("option",{value:t.id,children:t.name||`${t.origin} - ${t.destination}`},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Bus"}),e.jsxs("select",{value:w.busId,onChange:t=>y("busId",t.target.value),className:"border rounded px-2 py-1 w-full sm:w-auto",children:[e.jsx("option",{value:"",children:"All"}),W.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx(l,{onClick:D,variant:"outline",className:"w-full sm:w-auto",children:"Apply"})]})]}),e.jsx(l,{onClick:()=>window.location.reload(),className:"w-full sm:w-auto",children:"Refresh"})]}),T&&e.jsx(Y,{message:T,onRetry:D}),O?e.jsx(X,{className:"h-32 w-full"}):s?e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{children:"Revenue"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.revenue.byMonth,["month","revenue"],"revenue_by_month.csv"),children:"Download CSV"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(d,{width:"100%",height:250,children:e.jsxs($,{data:s.revenue.byMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(c,{strokeDasharray:"3 3"}),e.jsx(x,{dataKey:"month"}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(u,{}),e.jsx(G,{type:"monotone",dataKey:"revenue",stroke:"#4f46e5",strokeWidth:2,dot:!1})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Revenue"}),e.jsxs("div",{className:"text-xl font-bold",children:["NPR ",s.revenue.total.toLocaleString()]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Top Route"}),e.jsx("div",{className:"text-lg font-semibold",children:((_=s.revenue.byRoute[0])==null?void 0:_.routeName)||"-"}),e.jsxs("div",{className:"text-xs",children:["NPR"," ",((k=(o=s.revenue.byRoute[0])==null?void 0:o.revenue)==null?void 0:k.toLocaleString())||0]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Top Payment Method"}),e.jsx("div",{className:"text-lg font-semibold",children:((f=s.revenue.byPaymentMethod[0])==null?void 0:f.method)||"-"}),e.jsxs("div",{className:"text-xs",children:["NPR"," ",((F=(R=s.revenue.byPaymentMethod[0])==null?void 0:R._sum.amount)==null?void 0:F.toLocaleString())||0]})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Revenue This Month"}),e.jsxs("div",{className:"text-lg font-semibold",children:["NPR"," ",((I=(U=s.revenue.byMonth.slice(-1)[0])==null?void 0:U.revenue)==null?void 0:I.toLocaleString())||0]})]})]}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs(E,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Month"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Revenue (NPR)"})]})}),e.jsx("tbody",{children:s.revenue.byMonth.map(t=>e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.month}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:Number(t.revenue).toLocaleString()})]},t.month))})]})})]})]}),e.jsxs(j,{className:"mt-6",children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{children:"User Growth"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.users.newByMonth,["month","count"],"user_growth_by_month.csv"),children:"Download CSV"})]}),e.jsx(g,{children:e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(d,{width:"100%",height:250,children:e.jsxs(M,{data:s.users.newByMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(c,{strokeDasharray:"3 3"}),e.jsx(x,{dataKey:"month"}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(u,{}),e.jsx(B,{dataKey:"count",fill:"#6366f1",name:"New Users"})]})})})})]}),e.jsxs(j,{className:"mt-6",children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{children:"Booking Trends"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.bookings.byMonth,["month","count"],"bookings_by_month.csv"),children:"Download CSV"})]}),e.jsx(g,{children:e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(d,{width:"100%",height:250,children:e.jsxs($,{data:s.bookings.byMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(c,{strokeDasharray:"3 3"}),e.jsx(x,{dataKey:"month"}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(u,{}),e.jsx(G,{type:"monotone",dataKey:"count",stroke:"#10b981",strokeWidth:2,dot:!1,name:"Bookings"})]})})})})]}),e.jsxs(j,{className:"mt-6",children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{children:"Revenue by Route"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.revenue.byRoute,["routeName","revenue"],"revenue_by_route.csv"),children:"Download CSV"})]}),e.jsx(g,{children:e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(d,{width:"100%",height:250,children:e.jsxs(M,{data:s.revenue.byRoute,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(c,{strokeDasharray:"3 3"}),e.jsx(x,{dataKey:"routeName"}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(u,{}),e.jsx(B,{dataKey:"revenue",fill:"#f59e42",name:"Revenue"})]})})})})]}),e.jsxs(j,{className:"mt-6",children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{children:"Revenue by Bus"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.fleet.busUsage.map(t=>({busName:t.busName,trips:t.trips})),["busName","trips"],"bus_usage.csv"),children:"Download CSV"})]}),e.jsx(g,{children:e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(d,{width:"100%",height:250,children:e.jsxs(M,{data:s.fleet.busUsage,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(c,{strokeDasharray:"3 3"}),e.jsx(x,{dataKey:"busName"}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(u,{}),e.jsx(B,{dataKey:"trips",fill:"#3b82f6",name:"Trips"})]})})})})]}),e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{children:"Bookings"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.bookings.byMonth,["month","count"],"bookings_by_month.csv"),children:"Download CSV"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(d,{width:"100%",height:250,children:e.jsxs(M,{data:s.bookings.byMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(c,{strokeDasharray:"3 3"}),e.jsx(x,{dataKey:"month"}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(u,{}),e.jsx(B,{dataKey:"count",fill:"#16a34a"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Bookings"}),e.jsx("div",{className:"text-xl font-bold",children:s.bookings.total.toLocaleString()})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Top Route"}),e.jsx("div",{className:"text-lg font-semibold",children:((a=s.bookings.byRoute[0])==null?void 0:a.routeName)||"-"}),e.jsxs("div",{className:"text-xs",children:[((v=(i=s.bookings.byRoute[0])==null?void 0:i.count)==null?void 0:v.toLocaleString())||0," ","bookings"]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Most Common Status"}),e.jsx("div",{className:"text-lg font-semibold",children:((K=s.bookings.byStatus[0])==null?void 0:K.status)||"-"}),e.jsxs("div",{className:"text-xs",children:[((C=(A=s.bookings.byStatus[0])==null?void 0:A._count.status)==null?void 0:C.toLocaleString())||0," ","bookings"]})]})]}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs(E,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Month"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Bookings"})]})}),e.jsx("tbody",{children:s.bookings.byMonth.map(t=>e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.month}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:Number(t.count).toLocaleString()})]},t.month))})]})})]})]}),e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{children:"Users"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.users.newByMonth,["month","count"],"new_users_by_month.csv"),children:"Download CSV"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(d,{width:"100%",height:250,children:e.jsxs($,{data:s.users.newByMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(c,{strokeDasharray:"3 3"}),e.jsx(x,{dataKey:"month"}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(u,{}),e.jsx(G,{type:"monotone",dataKey:"count",stroke:"#f59e42",strokeWidth:2,dot:!1})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"New Users This Month"}),e.jsx("div",{className:"text-xl font-bold",children:((P=(N=s.users.newByMonth.slice(-1)[0])==null?void 0:N.count)==null?void 0:P.toLocaleString())||0})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Active Users This Month"}),e.jsx("div",{className:"text-xl font-bold",children:((H=(V=s.users.activeByMonth.slice(-1)[0])==null?void 0:V.count)==null?void 0:H.toLocaleString())||0})]})]}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs(E,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Month"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"New Users"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Active Users"})]})}),e.jsx("tbody",{children:s.users.newByMonth.map((t,z)=>{var S;return e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.month}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:Number(t.count).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:Number(((S=s.users.activeByMonth[z])==null?void 0:S.count)||0).toLocaleString()})]},t.month)})})]})})]})]}),e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{children:"Fleet Utilization"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.fleet.busUsage,["busName","trips"],"bus_usage.csv"),children:"Download CSV"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(d,{width:"100%",height:250,children:e.jsxs(M,{data:s.fleet.busUsage,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(c,{strokeDasharray:"3 3"}),e.jsx(x,{dataKey:"busName"}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(u,{}),e.jsx(B,{dataKey:"trips",fill:"#6366f1"})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(E,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Bus"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Trips"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Occupancy Rate"})]})}),e.jsx("tbody",{children:s.fleet.busUsage.map((t,z)=>{var S;return e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.busName}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.trips}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:((S=s.fleet.occupancyRate[z])==null?void 0:S.occupancy)!==void 0?`${(Number(s.fleet.occupancyRate[z].occupancy)*100).toFixed(1)}%`:"-"})]},t.busId)})})]})})]})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No report data found"})]})})};export{ie as default};
