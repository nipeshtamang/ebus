import{j as e,aw as V,ax as R}from"./ui-vendor-Dho0S5x9.js";import{a}from"./react-vendor-ByNQKlCH.js";import{C as v,a as P,b as E,d as A}from"./card-C7BQZI4A.js";import{B as j}from"./index-DMYsCFYG.js";import{T as H}from"./table-DNDMFJuf.js";import{S as K}from"./skeleton-XnDLFZGi.js";import{E as z}from"./error-message-D3zDD8H-.js";import{p as U}from"./superadminApi-Bjf7uKUS.js";import{B as I}from"./badge-C0YrEax5.js";import{I as _}from"./input-DM7v_Vsi.js";import{S as k,a as L,b as T,c as D,d as r}from"./select-DacTrhsM.js";import"./query-vendor-Br3W6GMP.js";import"./utils-vendor-Dq7h7Pqt.js";function G(){const[h,x]=a.useState([]),[o,b]=a.useState(0),[u,m]=a.useState(0),[p,l]=a.useState(1),[f,d]=a.useState(!1),[w,c]=a.useState(null),y=a.useCallback(async g=>{d(!0),c(null);try{const n=await U.getAllPayments(g);x(n.data.payments),b(n.data.total),m(n.data.totalPages),l(n.data.currentPage)}catch(n){c(n instanceof Error?n.message:"Failed to load payments")}finally{d(!1)}},[]);return{payments:h,total:o,totalPages:u,currentPage:p,loading:f,error:w,fetchPayments:y,setCurrentPage:l}}const le=()=>{const{payments:h,totalPages:x,currentPage:o,loading:b,error:u,fetchPayments:m,setCurrentPage:p}=G(),[l,f]=a.useState(""),[d,w]=a.useState("all"),[c,y]=a.useState("all"),g=a.useMemo(()=>{let s=h;return l&&(s=s.filter(t=>t.id.toString().includes(l.toLowerCase())||t.bookingId?.toString().includes(l.toLowerCase())||t.user?.name?.toLowerCase().includes(l.toLowerCase())||t.booking?.order?.id?.toString().includes(l.toLowerCase()))),d!=="all"&&(s=s.filter(t=>t.status===d)),c!=="all"&&(s=s.filter(t=>t.method===c)),s},[h,l,d,c]),n=a.useMemo(()=>{const s={};return g.forEach(t=>{const i=t.booking?.order?.id||"NO_ORDER";s[i]||(s[i]=[]),s[i].push(t)}),Object.entries(s)},[g]);a.useEffect(()=>{m({page:o})},[m,o]);const F=s=>{switch(s){case"COMPLETED":case"SUCCESS":return"bg-green-100 text-green-800 border-green-200";case"FAILED":case"CANCELLED":return"bg-red-100 text-red-800 border-red-200";case"PENDING":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},O=s=>{switch(s){case"CASH":return"bg-green-100 text-green-800 border-green-200";case"ESEWA":return"bg-blue-100 text-blue-800 border-blue-200";case"KHALTI":return"bg-purple-100 text-purple-800 border-purple-200";case"IPS_CONNECT":return"bg-pink-100 text-pink-800 border-pink-200";case"BANK":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},[N,C]=a.useState(null);return e.jsx("div",{className:"w-full min-h-screen bg-gradient-to-br from-white to-teal-50",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-6",children:"Payments"}),u&&e.jsx(z,{message:u,onRetry:()=>m({page:o})}),e.jsxs(v,{className:"mb-6",children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Filters"]})}),e.jsx(A,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(_,{placeholder:"Search by payment ID, booking ID, user name, or order ID...",value:l,onChange:s=>f(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(k,{value:d,onValueChange:w,children:[e.jsx(L,{children:e.jsx(T,{placeholder:"Filter by status"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all",children:"All Statuses"}),e.jsx(r,{value:"PENDING",children:"Pending"}),e.jsx(r,{value:"COMPLETED",children:"Completed"}),e.jsx(r,{value:"SUCCESS",children:"Success"}),e.jsx(r,{value:"FAILED",children:"Failed"}),e.jsx(r,{value:"CANCELLED",children:"Cancelled"})]})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(k,{value:c,onValueChange:y,children:[e.jsx(L,{children:e.jsx(T,{placeholder:"Filter by method"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all",children:"All Methods"}),e.jsx(r,{value:"CASH",children:"Cash"}),e.jsx(r,{value:"ESEWA",children:"eSewa"}),e.jsx(r,{value:"KHALTI",children:"Khalti"}),e.jsx(r,{value:"IPS_CONNECT",children:"IPS Connect"}),e.jsx(r,{value:"BANK",children:"Bank Transfer"})]})]})})]})})]}),e.jsxs(v,{children:[e.jsx(P,{children:e.jsxs(E,{children:["All Payments (",n.length,")"]})}),e.jsx(A,{children:b?e.jsx(K,{className:"h-8 w-full"}):n.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:l||d!=="all"||c!=="all"?"No payments match your filters":"No payments found"}):e.jsxs(H,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Order #"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Seats"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Total Amount"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Method"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{children:n.map(([s,t])=>{const i=t[0],B=t.reduce((S,M)=>S+(M.amount||0),0);return e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:s}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:i.user?.name||"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:[...new Set(t.map(S=>S.booking?.seat?.seatNumber))].join(", ")||"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsxs("span",{className:"font-semibold text-green-600",children:["Rs. ",B]})}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsx(I,{className:`${O(i.method)} border`,children:i.method})}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsx(I,{className:`${F(i.status)} border`,children:i.status})}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsx(j,{size:"sm",variant:"outline",onClick:()=>C({orderId:s,payments:t}),children:"View"})})]},s)})})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{size:"sm",variant:"outline",disabled:o===1,onClick:()=>p(o-1),children:"Previous"}),e.jsxs("span",{className:"px-2 py-1",children:["Page ",o," of ",x]}),e.jsx(j,{size:"sm",variant:"outline",disabled:o===x,onClick:()=>p(o+1),children:"Next"})]}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-lg",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4",children:["Order #",N.orderId," Payments"]}),e.jsx("ul",{className:"mb-4",children:N.payments.map(s=>e.jsxs("li",{className:"mb-2 border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Payment ID:"})," ",s.id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Amount:"})," Rs."," ",s.amount]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Method:"})," ",s.method]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",s.status]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Booking ID:"})," ",s.bookingId]})]},s.id))}),e.jsx(j,{onClick:()=>C(null),children:"Close"})]})})]})})};export{le as default};
