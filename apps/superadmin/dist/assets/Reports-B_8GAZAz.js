import{j as e,am as i,an as D,ao as d,ap as c,aq as x,ar as h,as as m,at as _,au as f,av as v}from"./ui-vendor-Dho0S5x9.js";import{C as u,a as j,b as p,d as b}from"./card-C7BQZI4A.js";import{B as l}from"./index-DMYsCFYG.js";import{T as C}from"./table-DNDMFJuf.js";import{S as $}from"./skeleton-XnDLFZGi.js";import{E as G}from"./error-message-D3zDD8H-.js";import{a as o}from"./react-vendor-ByNQKlCH.js";import{s as F}from"./superadminApi-Bjf7uKUS.js";import"./query-vendor-Br3W6GMP.js";import"./utils-vendor-Dq7h7Pqt.js";const q=()=>{const[s,S]=o.useState(null),[N,k]=o.useState(!1),[M,g]=o.useState(null),[w,R]=o.useState([]),[n,t]=o.useState([]),[a,U]=o.useState({dateFrom:"",dateTo:"",routeId:"",busId:""}),B=o.useCallback(()=>{k(!0),g(null),F.getSummaryReport({params:{...a.dateFrom&&{dateFrom:a.dateFrom},...a.dateTo&&{dateTo:a.dateTo},...a.routeId&&{routeId:a.routeId},...a.busId&&{busId:a.busId}}}).then(r=>S(r.data)).catch(r=>g(r instanceof Error?r.message:"Failed to load report")).finally(()=>k(!1))},[a]),I=o.useCallback(async()=>{try{const[r,y]=await Promise.all([F.getAllRoutes(),F.getAllBuses()]);R(r.data),t(y.data)}catch(r){console.error("Failed to fetch routes and buses:",r)}},[]),A=o.useCallback((r,y)=>{U(T=>({...T,[r]:y}))},[]),P=o.useCallback(()=>{U({dateFrom:"",dateTo:"",routeId:"",busId:""})},[]),V=o.useCallback((r,y,T)=>{const z=[y.join(",")].concat(r.map(O=>y.map(W=>String(O[W]??"")).join(","))).join(`
`),E=new Blob([z],{type:"text/csv"}),K=URL.createObjectURL(E),L=document.createElement("a");L.href=K,L.download=T,L.click(),URL.revokeObjectURL(K)},[]);return o.useEffect(()=>{I()},[I]),o.useEffect(()=>{B()},[B]),{report:s,loading:N,error:M,routes:w,buses:n,filters:a,updateFilter:A,clearFilters:P,fetchReport:B,downloadCSV:V}},oe=()=>{const{report:s,loading:S,error:N,routes:k,buses:M,filters:g,updateFilter:w,fetchReport:R,downloadCSV:n}=q();return e.jsx("div",{className:"w-full min-h-screen bg-gradient-to-br from-white to-teal-50",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Reports"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-2 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Date From"}),e.jsx("input",{type:"date",value:g.dateFrom,onChange:t=>w("dateFrom",t.target.value),className:"border rounded px-2 py-1 w-full sm:w-auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Date To"}),e.jsx("input",{type:"date",value:g.dateTo,onChange:t=>w("dateTo",t.target.value),className:"border rounded px-2 py-1 w-full sm:w-auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Route"}),e.jsxs("select",{value:g.routeId,onChange:t=>w("routeId",t.target.value),className:"border rounded px-2 py-1 w-full sm:w-auto",children:[e.jsx("option",{value:"",children:"All"}),k.map(t=>e.jsx("option",{value:t.id,children:t.name||`${t.origin} - ${t.destination}`},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Bus"}),e.jsxs("select",{value:g.busId,onChange:t=>w("busId",t.target.value),className:"border rounded px-2 py-1 w-full sm:w-auto",children:[e.jsx("option",{value:"",children:"All"}),M.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx(l,{onClick:R,variant:"outline",className:"w-full sm:w-auto",children:"Apply"})]})]}),e.jsx(l,{onClick:()=>window.location.reload(),className:"w-full sm:w-auto",children:"Refresh"})]}),N&&e.jsx(G,{message:N,onRetry:R}),S?e.jsx($,{className:"h-32 w-full"}):s?e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(p,{children:"Revenue"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.revenue.byMonth,["month","revenue"],"revenue_by_month.csv"),children:"Download CSV"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(i,{width:"100%",height:250,children:e.jsxs(D,{data:s.revenue.byMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(d,{strokeDasharray:"3 3"}),e.jsx(c,{dataKey:"month"}),e.jsx(x,{}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(_,{type:"monotone",dataKey:"revenue",stroke:"#4f46e5",strokeWidth:2,dot:!1})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Revenue"}),e.jsxs("div",{className:"text-xl font-bold",children:["NPR ",s.revenue.total.toLocaleString()]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Top Route"}),e.jsx("div",{className:"text-lg font-semibold",children:s.revenue.byRoute[0]?.routeName||"-"}),e.jsxs("div",{className:"text-xs",children:["NPR"," ",s.revenue.byRoute[0]?.revenue?.toLocaleString()||0]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Top Payment Method"}),e.jsx("div",{className:"text-lg font-semibold",children:s.revenue.byPaymentMethod[0]?.method||"-"}),e.jsxs("div",{className:"text-xs",children:["NPR"," ",s.revenue.byPaymentMethod[0]?._sum.amount?.toLocaleString()||0]})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Revenue This Month"}),e.jsxs("div",{className:"text-lg font-semibold",children:["NPR"," ",s.revenue.byMonth.slice(-1)[0]?.revenue?.toLocaleString()||0]})]})]}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs(C,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Month"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Revenue (NPR)"})]})}),e.jsx("tbody",{children:s.revenue.byMonth.map(t=>e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.month}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:Number(t.revenue).toLocaleString()})]},t.month))})]})})]})]}),e.jsxs(u,{className:"mt-6",children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(p,{children:"User Growth"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.users.newByMonth,["month","count"],"user_growth_by_month.csv"),children:"Download CSV"})]}),e.jsx(b,{children:e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(i,{width:"100%",height:250,children:e.jsxs(f,{data:s.users.newByMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(d,{strokeDasharray:"3 3"}),e.jsx(c,{dataKey:"month"}),e.jsx(x,{}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(v,{dataKey:"count",fill:"#6366f1",name:"New Users"})]})})})})]}),e.jsxs(u,{className:"mt-6",children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(p,{children:"Booking Trends"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.bookings.byMonth,["month","count"],"bookings_by_month.csv"),children:"Download CSV"})]}),e.jsx(b,{children:e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(i,{width:"100%",height:250,children:e.jsxs(D,{data:s.bookings.byMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(d,{strokeDasharray:"3 3"}),e.jsx(c,{dataKey:"month"}),e.jsx(x,{}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(_,{type:"monotone",dataKey:"count",stroke:"#10b981",strokeWidth:2,dot:!1,name:"Bookings"})]})})})})]}),e.jsxs(u,{className:"mt-6",children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(p,{children:"Revenue by Route"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.revenue.byRoute,["routeName","revenue"],"revenue_by_route.csv"),children:"Download CSV"})]}),e.jsx(b,{children:e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(i,{width:"100%",height:250,children:e.jsxs(f,{data:s.revenue.byRoute,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(d,{strokeDasharray:"3 3"}),e.jsx(c,{dataKey:"routeName"}),e.jsx(x,{}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(v,{dataKey:"revenue",fill:"#f59e42",name:"Revenue"})]})})})})]}),e.jsxs(u,{className:"mt-6",children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(p,{children:"Revenue by Bus"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.fleet.busUsage.map(t=>({busName:t.busName,trips:t.trips})),["busName","trips"],"bus_usage.csv"),children:"Download CSV"})]}),e.jsx(b,{children:e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(i,{width:"100%",height:250,children:e.jsxs(f,{data:s.fleet.busUsage,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(d,{strokeDasharray:"3 3"}),e.jsx(c,{dataKey:"busName"}),e.jsx(x,{}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(v,{dataKey:"trips",fill:"#3b82f6",name:"Trips"})]})})})})]}),e.jsxs(u,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(p,{children:"Bookings"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.bookings.byMonth,["month","count"],"bookings_by_month.csv"),children:"Download CSV"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(i,{width:"100%",height:250,children:e.jsxs(f,{data:s.bookings.byMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(d,{strokeDasharray:"3 3"}),e.jsx(c,{dataKey:"month"}),e.jsx(x,{}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(v,{dataKey:"count",fill:"#16a34a"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Bookings"}),e.jsx("div",{className:"text-xl font-bold",children:s.bookings.total.toLocaleString()})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Top Route"}),e.jsx("div",{className:"text-lg font-semibold",children:s.bookings.byRoute[0]?.routeName||"-"}),e.jsxs("div",{className:"text-xs",children:[s.bookings.byRoute[0]?.count?.toLocaleString()||0," ","bookings"]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Most Common Status"}),e.jsx("div",{className:"text-lg font-semibold",children:s.bookings.byStatus[0]?.status||"-"}),e.jsxs("div",{className:"text-xs",children:[s.bookings.byStatus[0]?._count.status?.toLocaleString()||0," ","bookings"]})]})]}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs(C,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Month"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Bookings"})]})}),e.jsx("tbody",{children:s.bookings.byMonth.map(t=>e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.month}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:Number(t.count).toLocaleString()})]},t.month))})]})})]})]}),e.jsxs(u,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(p,{children:"Users"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.users.newByMonth,["month","count"],"new_users_by_month.csv"),children:"Download CSV"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(i,{width:"100%",height:250,children:e.jsxs(D,{data:s.users.newByMonth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(d,{strokeDasharray:"3 3"}),e.jsx(c,{dataKey:"month"}),e.jsx(x,{}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(_,{type:"monotone",dataKey:"count",stroke:"#f59e42",strokeWidth:2,dot:!1})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"New Users This Month"}),e.jsx("div",{className:"text-xl font-bold",children:s.users.newByMonth.slice(-1)[0]?.count?.toLocaleString()||0})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Active Users This Month"}),e.jsx("div",{className:"text-xl font-bold",children:s.users.activeByMonth.slice(-1)[0]?.count?.toLocaleString()||0})]})]}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs(C,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Month"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"New Users"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Active Users"})]})}),e.jsx("tbody",{children:s.users.newByMonth.map((t,a)=>e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.month}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:Number(t.count).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:Number(s.users.activeByMonth[a]?.count||0).toLocaleString()})]},t.month))})]})})]})]}),e.jsxs(u,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(p,{children:"Fleet Utilization"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(s.fleet.busUsage,["busName","trips"],"bus_usage.csv"),children:"Download CSV"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"mb-4",style:{width:"100%",height:250},children:e.jsx(i,{width:"100%",height:250,children:e.jsxs(f,{data:s.fleet.busUsage,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(d,{strokeDasharray:"3 3"}),e.jsx(c,{dataKey:"busName"}),e.jsx(x,{}),e.jsx(h,{}),e.jsx(m,{}),e.jsx(v,{dataKey:"trips",fill:"#6366f1"})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(C,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Bus"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Trips"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Occupancy Rate"})]})}),e.jsx("tbody",{children:s.fleet.busUsage.map((t,a)=>e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.busName}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.trips}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:s.fleet.occupancyRate[a]?.occupancy!==void 0?`${(Number(s.fleet.occupancyRate[a].occupancy)*100).toFixed(1)}%`:"-"})]},t.busId))})]})})]})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No report data found"})]})})};export{oe as default};
