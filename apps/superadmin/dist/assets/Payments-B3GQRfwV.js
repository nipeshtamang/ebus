import{j as e,aw as H,ax as K}from"./ui-vendor-BPnJF_7J.js";import{r as a}from"./react-vendor-Bgq3EpD8.js";import{C as I,a as k,b as L,d as T}from"./card-CoINBLpb.js";import{B as N}from"./index-C5bx2-Fn.js";import{T as z}from"./table-mXJe5lnO.js";import{S as U}from"./skeleton-BmX8kKu8.js";import{E as _}from"./error-message-yDPqqqhZ.js";import{p as G}from"./superadminApi-Bft6DRZm.js";import{B as D}from"./badge-CVKJlgmv.js";import{I as W}from"./input-CM-I2g3X.js";import{S as F,a as O,b as B,c as M,d as l}from"./select-CUjAH3A_.js";import"./query-vendor-B3bfG-l7.js";import"./utils-vendor-Dq7h7Pqt.js";function $(){const[j,b]=a.useState([]),[i,S]=a.useState(0),[f,p]=a.useState(0),[w,n]=a.useState(1),[C,d]=a.useState(!1),[v,c]=a.useState(null),P=a.useCallback(async y=>{d(!0),c(null);try{const o=await G.getAllPayments(y);b(o.data.payments),S(o.data.total),p(o.data.totalPages),n(o.data.currentPage)}catch(o){c(o instanceof Error?o.message:"Failed to load payments")}finally{d(!1)}},[]);return{payments:j,total:i,totalPages:f,currentPage:w,loading:C,error:v,fetchPayments:P,setCurrentPage:n}}const oe=()=>{const{payments:j,totalPages:b,currentPage:i,loading:S,error:f,fetchPayments:p,setCurrentPage:w}=$(),[n,C]=a.useState(""),[d,v]=a.useState("all"),[c,P]=a.useState("all"),y=a.useMemo(()=>{let s=j;return n&&(s=s.filter(t=>{var r,h,m,u,x,g;return t.id.toString().includes(n.toLowerCase())||((r=t.bookingId)==null?void 0:r.toString().includes(n.toLowerCase()))||((m=(h=t.user)==null?void 0:h.name)==null?void 0:m.toLowerCase().includes(n.toLowerCase()))||((g=(x=(u=t.booking)==null?void 0:u.order)==null?void 0:x.id)==null?void 0:g.toString().includes(n.toLowerCase()))})),d!=="all"&&(s=s.filter(t=>t.status===d)),c!=="all"&&(s=s.filter(t=>t.method===c)),s},[j,n,d,c]),o=a.useMemo(()=>{const s={};return y.forEach(t=>{var h,m;const r=((m=(h=t.booking)==null?void 0:h.order)==null?void 0:m.id)||"NO_ORDER";s[r]||(s[r]=[]),s[r].push(t)}),Object.entries(s)},[y]);a.useEffect(()=>{p({page:i})},[p,i]);const V=s=>{switch(s){case"COMPLETED":case"SUCCESS":return"bg-green-100 text-green-800 border-green-200";case"FAILED":case"CANCELLED":return"bg-red-100 text-red-800 border-red-200";case"PENDING":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},R=s=>{switch(s){case"CASH":return"bg-green-100 text-green-800 border-green-200";case"ESEWA":return"bg-blue-100 text-blue-800 border-blue-200";case"KHALTI":return"bg-purple-100 text-purple-800 border-purple-200";case"IPS_CONNECT":return"bg-pink-100 text-pink-800 border-pink-200";case"BANK":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},[E,A]=a.useState(null);return e.jsx("div",{className:"w-full min-h-screen bg-gradient-to-br from-white to-teal-50",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-6",children:"Payments"}),f&&e.jsx(_,{message:f,onRetry:()=>p({page:i})}),e.jsxs(I,{className:"mb-6",children:[e.jsx(k,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Filters"]})}),e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(W,{placeholder:"Search by payment ID, booking ID, user name, or order ID...",value:n,onChange:s=>C(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(F,{value:d,onValueChange:v,children:[e.jsx(O,{children:e.jsx(B,{placeholder:"Filter by status"})}),e.jsxs(M,{children:[e.jsx(l,{value:"all",children:"All Statuses"}),e.jsx(l,{value:"PENDING",children:"Pending"}),e.jsx(l,{value:"COMPLETED",children:"Completed"}),e.jsx(l,{value:"SUCCESS",children:"Success"}),e.jsx(l,{value:"FAILED",children:"Failed"}),e.jsx(l,{value:"CANCELLED",children:"Cancelled"})]})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(F,{value:c,onValueChange:P,children:[e.jsx(O,{children:e.jsx(B,{placeholder:"Filter by method"})}),e.jsxs(M,{children:[e.jsx(l,{value:"all",children:"All Methods"}),e.jsx(l,{value:"CASH",children:"Cash"}),e.jsx(l,{value:"ESEWA",children:"eSewa"}),e.jsx(l,{value:"KHALTI",children:"Khalti"}),e.jsx(l,{value:"IPS_CONNECT",children:"IPS Connect"}),e.jsx(l,{value:"BANK",children:"Bank Transfer"})]})]})})]})})]}),e.jsxs(I,{children:[e.jsx(k,{children:e.jsxs(L,{children:["All Payments (",o.length,")"]})}),e.jsx(T,{children:S?e.jsx(U,{className:"h-8 w-full"}):o.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:n||d!=="all"||c!=="all"?"No payments match your filters":"No payments found"}):e.jsxs(z,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Order #"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Seats"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Total Amount"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Method"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{children:o.map(([s,t])=>{var m;const r=t[0],h=t.reduce((u,x)=>u+(x.amount||0),0);return e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:s}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:((m=r.user)==null?void 0:m.name)||"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:[...new Set(t.map(u=>{var x,g;return(g=(x=u.booking)==null?void 0:x.seat)==null?void 0:g.seatNumber}))].join(", ")||"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsxs("span",{className:"font-semibold text-green-600",children:["Rs. ",h]})}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsx(D,{className:`${R(r.method)} border`,children:r.method})}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsx(D,{className:`${V(r.status)} border`,children:r.status})}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsx(N,{size:"sm",variant:"outline",onClick:()=>A({orderId:s,payments:t}),children:"View"})})]},s)})})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(N,{size:"sm",variant:"outline",disabled:i===1,onClick:()=>w(i-1),children:"Previous"}),e.jsxs("span",{className:"px-2 py-1",children:["Page ",i," of ",b]}),e.jsx(N,{size:"sm",variant:"outline",disabled:i===b,onClick:()=>w(i+1),children:"Next"})]}),E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-lg",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4",children:["Order #",E.orderId," Payments"]}),e.jsx("ul",{className:"mb-4",children:E.payments.map(s=>e.jsxs("li",{className:"mb-2 border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Payment ID:"})," ",s.id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Amount:"})," Rs."," ",s.amount]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Method:"})," ",s.method]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",s.status]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Booking ID:"})," ",s.bookingId]})]},s.id))}),e.jsx(N,{onClick:()=>A(null),children:"Close"})]})})]})})};export{oe as default};
