import{j as e,aw as M,ax as V,ag as T}from"./ui-vendor-BPnJF_7J.js";import{r as s}from"./react-vendor-Bgq3EpD8.js";import{C as D,a as E,b as v,d as A}from"./card-CoINBLpb.js";import{B as N,T as z,a as $,b as H,d as K,A as R,e as U,f as q,g as G,h as J,i as Q,j as W,k as X}from"./index-C5bx2-Fn.js";import{T as Y}from"./table-mXJe5lnO.js";import{S as Z}from"./skeleton-BmX8kKu8.js";import{E as _}from"./error-message-yDPqqqhZ.js";import{B as ee}from"./badge-CVKJlgmv.js";import{I as se}from"./input-CM-I2g3X.js";import{S as ae,a as te,b as le,c as re,d as y}from"./select-CUjAH3A_.js";import{b as P}from"./superadminApi-Bft6DRZm.js";import"./query-vendor-B3bfG-l7.js";import"./utils-vendor-Dq7h7Pqt.js";function ne(){const[c,p]=s.useState([]),[r,j]=s.useState(0),[f,u]=s.useState(0),[h,C]=s.useState(1),[n,i]=s.useState(!1),[b,g]=s.useState(null),d=s.useCallback(async o=>{i(!0),g(null);try{const t=await P.getAllBookings(o);p(t.data.bookings),j(t.data.total),u(t.data.totalPages),C(t.data.currentPage)}catch(t){g(t instanceof Error?t.message:"Failed to load bookings")}finally{i(!1)}},[]),x=s.useCallback(async o=>{i(!0),g(null);try{await P.cancelBooking(o),await d({page:h})}catch(t){g(t instanceof Error?t.message:"Failed to cancel booking")}finally{i(!1)}},[d,h]);return{bookings:c,total:r,totalPages:f,currentPage:h,loading:n,error:b,fetchBookings:d,cancelBooking:x,setCurrentPage:C}}function oe(){const{bookings:c,totalPages:p,currentPage:r,loading:j,error:f,fetchBookings:u,cancelBooking:h,setCurrentPage:C}=ne(),[n,i]=s.useState({searchTerm:"",statusFilter:"all"}),[b,g]=s.useState(c),[d,x]=s.useState(!1),[o,t]=s.useState(null);s.useEffect(()=>{let a=c;n.searchTerm&&(a=a.filter(m=>{var S,B;return m.id.toString().includes(n.searchTerm.toLowerCase())||((B=(S=m.user)==null?void 0:S.name)==null?void 0:B.toLowerCase().includes(n.searchTerm.toLowerCase()))})),n.statusFilter!=="all"&&(a=a.filter(m=>m.status===n.statusFilter)),g(a)},[c,n.searchTerm,n.statusFilter]);const k=s.useCallback(a=>{i(m=>({...m,searchTerm:a}))},[]),l=s.useCallback(a=>{i(m=>({...m,statusFilter:a}))},[]),w=s.useCallback(a=>{switch(a){case"COMPLETED":return"bg-green-100 text-green-800 border-green-200";case"CANCELLED":return"bg-red-100 text-red-800 border-red-200";case"BOOKED":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},[]),F=s.useCallback(a=>{t(a),x(!0)},[]),L=s.useCallback(async()=>{if(o)try{return await h(o),{success:!0}}catch(a){return{success:!1,error:a}}finally{x(!1),t(null)}return{success:!1}},[o,h]),O=s.useCallback(()=>{x(!1),t(null)},[]),I=s.useCallback(a=>a!=="COMPLETED"&&a!=="CANCELLED",[]);return{bookings:b,totalPages:p,currentPage:r,loading:j,error:f,filters:n,updateSearchTerm:k,updateStatusFilter:l,showCancelDialog:d,selectedBookingId:o,handleCancel:F,confirmCancel:L,closeCancelDialog:O,fetchBookings:u,setCurrentPage:C,getStatusBadgeVariant:w,canCancelBooking:I}}const we=()=>{const{bookings:c,totalPages:p,currentPage:r,loading:j,error:f,filters:u,updateSearchTerm:h,updateStatusFilter:C,showCancelDialog:n,handleCancel:i,confirmCancel:b,closeCancelDialog:g,fetchBookings:d,setCurrentPage:x,getStatusBadgeVariant:o,canCancelBooking:t}=oe();s.useEffect(()=>{d({page:r})},[d,r]);const k=async()=>{(await b()).success?T.success("Booking cancelled successfully!"):T.error("Failed to cancel booking")};return e.jsx("div",{className:"w-full min-h-screen bg-gradient-to-br from-white to-teal-50",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-6",children:"Bookings"}),f&&e.jsx(_,{message:f,onRetry:()=>d({page:r})}),e.jsxs(D,{className:"mb-6",children:[e.jsx(E,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Filters"]})}),e.jsx(A,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(se,{placeholder:"Search by booking ID or user name...",value:u.searchTerm,onChange:l=>h(l.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(ae,{value:u.statusFilter,onValueChange:C,children:[e.jsx(te,{children:e.jsx(le,{placeholder:"Filter by status"})}),e.jsxs(re,{children:[e.jsx(y,{value:"all",children:"All Statuses"}),e.jsx(y,{value:"BOOKED",children:"Booked"}),e.jsx(y,{value:"COMPLETED",children:"Completed"}),e.jsx(y,{value:"CANCELLED",children:"Cancelled"})]})]})})]})})]}),e.jsxs(D,{children:[e.jsx(E,{children:e.jsxs(v,{children:["All Bookings (",c.length,")"]})}),e.jsx(A,{children:j?e.jsx(Z,{className:"h-8 w-full"}):c.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:u.searchTerm||u.statusFilter!=="all"?"No bookings match your filters":"No bookings found"}):e.jsxs(Y,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Created At"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{children:c.map(l=>{var w;return e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:l.id}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:((w=l.user)==null?void 0:w.name)||"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsx(ee,{className:`${o(l.status)} border`,children:l.status})}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:new Date(l.createdAt).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t(l.status)?e.jsx(N,{size:"sm",variant:"destructive",onClick:()=>i(l.id),"aria-label":`Cancel booking ${l.id}`,children:e.jsx(z,{children:e.jsxs($,{children:[e.jsx(H,{asChild:!0,children:e.jsx("span",{children:"Cancel"})}),e.jsx(K,{children:"Cancel this booking"})]})})}):e.jsx("span",{className:`text-sm font-medium ${l.status==="COMPLETED"?"text-green-600":"text-red-600"}`,children:l.status==="COMPLETED"?"Completed":"Cancelled"})})]},l.id)})})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(N,{size:"sm",variant:"outline",disabled:r===1,onClick:()=>x(r-1),children:"Previous"}),e.jsxs("span",{className:"px-2 py-1",children:["Page ",r," of ",p]}),e.jsx(N,{size:"sm",variant:"outline",disabled:r===p,onClick:()=>x(r+1),children:"Next"})]}),e.jsx(R,{open:n,onOpenChange:g,children:e.jsxs(U,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Confirm Cancel"}),e.jsx(J,{children:"Are you sure you want to cancel this booking? This action cannot be undone and the seat will be released for others to book. A cancellation email will be sent to the customer."})]}),e.jsxs(Q,{children:[e.jsx(W,{children:"Cancel"}),e.jsx(X,{onClick:k,className:"bg-red-600 hover:bg-red-700",children:"Cancel Booking"})]})]})})]})})};export{we as default};
