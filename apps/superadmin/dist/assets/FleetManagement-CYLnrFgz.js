import{ag as D,j as e,ai as Rt,aj as kt,ak as Bt,al as Dt}from"./ui-vendor-BPnJF_7J.js";import{r as n}from"./react-vendor-Bgq3EpD8.js";import{C as G,a as J,b as K,d as Q}from"./card-CoINBLpb.js";import{c as oe,B as b,T as It,a as it,b as ot,d as ct,A as Ae,e as Fe,f as Ee,g as Le,i as $e,j as Oe,k as _e}from"./index-C5bx2-Fn.js";import{T as Me}from"./table-mXJe5lnO.js";import{S as Pe}from"./skeleton-BmX8kKu8.js";import{f as k,s as Tt}from"./superadminApi-Bft6DRZm.js";import{D as ze,b as qe,c as He,d as Ve,e as Ye}from"./dialog-kKasmLKn.js";import"./query-vendor-B3bfG-l7.js";import"./utils-vendor-Dq7h7Pqt.js";function At(){const[f,h]=n.useState([]),[M,v]=n.useState([]),[U,B]=n.useState([]),[ce,j]=n.useState(!1),[Z,I]=n.useState(null),[ue,ee]=n.useState(!1),[he,W]=n.useState(!1),[xe,te]=n.useState(!1),[me,m]=n.useState(null),F=n.useRef({buses:[],routes:[],schedules:[]}),u=n.useCallback((a,l)=>{const d=a instanceof Error?a.message:`Failed to ${l}`;I(d),D.error(d),console.error(`Error in ${l}:`,a)},[]),p=n.useCallback(a=>{I(null),D.success(a)},[]),X=n.useCallback(async()=>{ee(!0),I(null);try{const a=await k.getAllBuses();F.current.buses=a.data,h(a.data)}catch(a){u(a,"load buses")}finally{ee(!1)}},[u]),pe=n.useCallback(async a=>{m("createBus");try{const l={id:Date.now(),name:a.name,layoutType:a.layoutType,seatCount:a.seatCount,schedules:[]};h(s=>[...s,l]);const d=await k.createBus(a);h(s=>s.map(i=>i.id===l.id?d.data:i)),p("Bus created successfully!")}catch(l){throw h(d=>d.filter(s=>s.id!==Date.now())),u(l,"create bus"),l}finally{m(null)}},[u,p]),P=n.useCallback(async(a,l)=>{m(`updateBus_${a}`);try{h(s=>s.map(i=>i.id===a?{...i,...l}:i));const d=await k.updateBus(a,l);h(s=>s.map(i=>i.id===a?d.data:i)),p("Bus updated successfully!")}catch(d){throw h(s=>s.map(i=>i.id===a&&F.current.buses.find(w=>w.id===a)||i)),u(d,"update bus"),d}finally{m(null)}},[u,p]),se=n.useCallback(async a=>{m(`deleteBus_${a}`);try{h(l=>l.filter(d=>d.id!==a)),await k.deleteBus(a),p("Bus deleted successfully!")}catch(l){const d=f.find(s=>s.id===a);throw d&&h(s=>[...s,d]),u(l,"delete bus"),l}finally{m(null)}},[f,u,p]),N=n.useCallback(async()=>{W(!0),I(null);try{const a=await k.getAllRoutes();F.current.routes=a.data,v(a.data)}catch(a){u(a,"load routes")}finally{W(!1)}},[u]),z=n.useCallback(async a=>{m("createRoute");try{const l={id:Date.now(),name:a.name,origin:a.origin,destination:a.destination};v(s=>[...s,l]);const d=await k.createRoute(a);v(s=>s.map(i=>i.id===l.id?d.data:i)),p("Route created successfully!")}catch(l){throw v(d=>d.filter(s=>s.id!==Date.now())),u(l,"create route"),l}finally{m(null)}},[u,p]),q=n.useCallback(async(a,l)=>{m(`updateRoute_${a}`);try{v(s=>s.map(i=>i.id===a?{...i,...l}:i));const d=await k.updateRoute(a,l);v(s=>s.map(i=>i.id===a?d.data:i)),p("Route updated successfully!")}catch(d){throw v(s=>s.map(i=>i.id===a&&F.current.routes.find(w=>w.id===a)||i)),u(d,"update route"),d}finally{m(null)}},[u,p]),ae=n.useCallback(async a=>{m(`deleteRoute_${a}`);try{v(l=>l.filter(d=>d.id!==a)),await k.deleteRoute(a),p("Route deleted successfully!")}catch(l){const d=M.find(s=>s.id===a);throw d&&v(s=>[...s,d]),u(l,"delete route"),l}finally{m(null)}},[M,u,p]),C=n.useCallback(async()=>{te(!0),I(null);try{const a=await k.getAllSchedules();F.current.schedules=a.data,B(a.data)}catch(a){u(a,"load schedules")}finally{te(!1)}},[u]),H=n.useCallback(async a=>{var l,d;m("createSchedule");try{console.log("Creating schedule with data:",a);const s={id:Date.now(),...a};B(w=>[...w,s]);const i=await k.createSchedule(a);console.log("Schedule creation response:",i),B(w=>w.map(V=>V.id===s.id?i.data:V)),p("Schedule created successfully!")}catch(s){throw console.error("Schedule creation error details:",{error:s,response:(l=s==null?void 0:s.response)==null?void 0:l.data,status:(d=s==null?void 0:s.response)==null?void 0:d.status,message:s==null?void 0:s.message}),B(i=>i.filter(w=>w.id!==Date.now())),u(s,"create schedule"),s}finally{m(null)}},[u,p]),ge=n.useCallback(async(a,l)=>{m(`updateSchedule_${a}`);try{B(s=>s.map(i=>i.id===a?{...i,...l}:i));const d=await k.updateSchedule(a,l);B(s=>s.map(i=>i.id===a?d.data:i)),p("Schedule updated successfully!")}catch(d){throw B(s=>s.map(i=>i.id===a&&F.current.schedules.find(w=>w.id===a)||i)),u(d,"update schedule"),d}finally{m(null)}},[u,p]),je=n.useCallback(async a=>{m(`deleteSchedule_${a}`);try{B(l=>l.filter(d=>d.id!==a)),await k.deleteSchedule(a),p("Schedule deleted successfully!")}catch(l){const d=U.find(s=>s.id===a);throw d&&B(s=>[...s,d]),u(l,"delete schedule"),l}finally{m(null)}},[U,u,p]),re=n.useCallback(async()=>{j(!0);try{await Promise.all([X(),N(),C()]),p("Data refreshed successfully!")}catch(a){u(a,"refresh data")}finally{j(!1)}},[X,N,C,u,p]);return{buses:f,routes:M,schedules:U,loading:ce,busesLoading:ue,routesLoading:he,schedulesLoading:xe,operationLoading:me,error:Z,fetchBuses:X,createBus:pe,updateBus:P,deleteBus:se,fetchRoutes:N,createRoute:z,updateRoute:q,deleteRoute:ae,fetchSchedules:C,createSchedule:H,updateSchedule:ge,deleteSchedule:je,refreshAll:re,clearError:()=>I(null)}}function Ft({className:f,...h}){return e.jsx(Rt,{"data-slot":"tabs",className:oe("flex flex-col gap-2",f),...h})}function Et({className:f,...h}){return e.jsx(kt,{"data-slot":"tabs-list",className:oe("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",f),...h})}function Ge({className:f,...h}){return e.jsx(Bt,{"data-slot":"tabs-trigger",className:oe("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",f),...h})}function Je({className:f,...h}){return e.jsx(Dt,{"data-slot":"tabs-content",className:oe("flex-1 outline-none",f),...h})}const Yt=()=>{const{buses:f,routes:h,schedules:M,loading:v,busesLoading:U,routesLoading:B,schedulesLoading:ce,operationLoading:j,error:Z,fetchBuses:I,createBus:ue,updateBus:ee,deleteBus:he,fetchRoutes:W,createRoute:xe,updateRoute:te,deleteRoute:me,fetchSchedules:m,createSchedule:F,updateSchedule:u,deleteSchedule:p,refreshAll:X,clearError:pe}=At(),[P,se]=n.useState(!1),[N,z]=n.useState({name:"",layoutType:"Standard",seatCount:40}),[q,ae]=n.useState(!1),[C,H]=n.useState({name:"",origin:"",destination:""}),[ge,je]=n.useState("buses"),[re,a]=n.useState(!1),[l,d]=n.useState({routeId:0,busId:0,departure:"",fare:0,isReturn:!1}),[s,i]=n.useState(null),[w,V]=n.useState(null),[y,Y]=n.useState(null),[le,fe]=n.useState(null),[L,$]=n.useState(null),[O,_]=n.useState(null),[S,ne]=n.useState({}),[R,de]=n.useState({}),[g,T]=n.useState({}),[c,E]=n.useState(null),[ie,be]=n.useState(null),[ye,Ke]=n.useState(""),[we,Qe]=n.useState(""),[ve,Ue]=n.useState(""),[Ne,We]=n.useState(""),[Ce,Xe]=n.useState(""),[Se,Ze]=n.useState(""),[Re,et]=n.useState(""),[ke,tt]=n.useState(""),[Be,st]=n.useState(""),[De,at]=n.useState("");n.useEffect(()=>{I(),W(),m()},[I,W,m]);const rt=t=>{const r={};return t.name.trim()||(r.name="Name is required."),t.layoutType.trim()||(r.layoutType="Layout type is required."),(!t.seatCount||t.seatCount<=0)&&(r.seatCount="Seat count must be positive."),r},lt=t=>{const r={};return t.name.trim()||(r.name="Name is required."),t.origin.trim()||(r.origin="Origin is required."),t.destination.trim()||(r.destination="Destination is required."),r},Ie=t=>{const r={};return(!t.routeId||t.routeId<=0)&&(r.routeId="Route is required."),(!t.busId||t.busId<=0)&&(r.busId="Bus is required."),t.departure||(r.departure="Departure is required."),(!t.fare||t.fare<=0)&&(r.fare="Fare must be positive."),r},ut=()=>{const t=Ie(l);return Object.keys(t).length===0},ht=async()=>{const t=rt(N);if(ne(t),Object.keys(t).length>0){D.error("Please fix the errors in the form.");return}try{await ue(N),se(!1),z({name:"",layoutType:"Standard",seatCount:40}),ne({})}catch{}},xt=async()=>{const t=lt(C);if(de(t),Object.keys(t).length>0){D.error("Please fix the errors in the form.");return}try{await xe(C),ae(!1),H({name:"",origin:"",destination:""}),de({})}catch{}},mt=async()=>{const t=Ie(l);if(T(t),Object.keys(t).length>0){D.error("Please fix the errors in the form.");return}console.log("Creating schedule with data:",l);const r={...l,departure:new Date(l.departure).toISOString()};console.log("Converted schedule data:",r);try{await F(r),a(!1),d({routeId:0,busId:0,departure:"",fare:0,isReturn:!1}),T({})}catch(x){console.error("Schedule creation error:",x)}},pt=t=>{i({name:t.name,layoutType:t.layoutType,seatCount:t.seatCount}),V(t.id)},gt=t=>{Y({name:t.name,origin:t.origin,destination:t.destination}),fe(t.id)},jt=t=>{E({routeId:t.routeId,busId:t.busId,departure:t.departure,fare:t.fare,isReturn:t.isReturn}),be(t.id)},ft=async()=>{if(!s)return;const t=rt(s);if(ne(t),Object.keys(t).length>0){D.error("Please fix the errors in the form.");return}try{await ee(w,s),i(null),V(null),ne({})}catch{}},bt=async()=>{if(!y)return;const t=lt(y);if(de(t),Object.keys(t).length>0){D.error("Please fix the errors in the form.");return}try{await te(le,y),Y(null),fe(null),de({})}catch{}},yt=async()=>{if(!c)return;const t=Ie(c);if(T(t),Object.keys(t).length>0){D.error("Please fix the errors in the form.");return}const r={...c,departure:new Date(c.departure).toISOString()};try{await u(ie,r),E(null),be(null),T({})}catch(x){console.error("Schedule update error:",x)}},Te=async()=>{if(!(!O||!L))try{L==="bus"?await he(O):L==="route"?await me(O):L==="schedule"&&await p(O),$(null),_(null)}catch{}},wt=async t=>{try{await Tt.regenerateSeats(t),await m(),D.success("Seats regenerated successfully!")}catch(r){console.error("Error regenerating seats:",r),D.error("Failed to regenerate seats. Please check if there are any existing bookings.")}},vt=f.filter(t=>{const r=!ye||t.layoutType===ye,x=we===""||t.seatCount>=Number(we),A=ve===""||t.seatCount<=Number(ve),o=!Ne||t.schedules.some(St=>{var nt,dt;return((dt=(nt=St.route)==null?void 0:nt.id)==null?void 0:dt.toString())===Ne});return r&&x&&A&&o}),Nt=h.filter(t=>{const r=!Ce||t.origin===Ce,x=!Se||t.destination===Se;return r&&x}),Ct=M.filter(t=>{const r=!Re||t.routeId.toString()===Re,x=!ke||t.busId.toString()===ke,A=!Be||t.departure.slice(0,10)===Be,o=!De||(De==="return"?t.isReturn:!t.isReturn);return r&&x&&A&&o});return e.jsx("div",{className:"w-full min-h-screen bg-gradient-to-br from-white to-teal-50",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Fleet Management"}),Z&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-red-600 font-medium",children:"Error:"}),e.jsx("span",{className:"text-red-700",children:Z}),e.jsx("button",{onClick:pe,className:"ml-auto text-red-500 hover:text-red-700",children:"✕"})]})})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[e.jsxs(b,{onClick:X,disabled:v,variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[v?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}):e.jsx("span",{children:"↻"}),"Refresh"]}),e.jsxs(It,{children:[e.jsxs(it,{children:[e.jsx(ot,{asChild:!0,children:e.jsx(b,{onClick:()=>se(t=>!t),"aria-label":P?"Cancel add bus":"Add new bus",className:"w-full sm:w-auto",children:P?"Cancel":"Add Bus"})}),e.jsx(ct,{children:P?"Cancel adding a new bus":"Add a new bus to the fleet"})]}),e.jsxs(it,{children:[e.jsx(ot,{asChild:!0,children:e.jsx(b,{onClick:()=>ae(t=>!t),"aria-label":q?"Cancel add route":"Add new route",className:"w-full sm:w-auto",children:q?"Cancel":"Add Route"})}),e.jsx(ct,{children:q?"Cancel adding a new route":"Add a new route"})]})]})]})]}),e.jsxs(Ft,{value:ge,onValueChange:je,className:"w-full",children:[e.jsxs(Et,{className:"mb-4",children:[e.jsx(Ge,{value:"buses",children:"Buses"}),e.jsx(Ge,{value:"routes",children:"Routes"}),e.jsx(Ge,{value:"schedules",children:"Schedules"})]}),e.jsxs(Je,{value:"buses",children:[P&&e.jsxs(G,{className:"mb-4 transition-all duration-300 ease-in-out",children:[e.jsx(J,{children:e.jsx(K,{children:"Add New Bus"})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-2 items-stretch md:items-center",children:[e.jsx("input",{className:"border rounded px-2 py-1 flex-1 min-w-0",placeholder:"Bus Name","aria-label":"Bus Name",value:N.name,onChange:t=>z({...N,name:t.target.value})}),S.name&&e.jsx("div",{className:"text-xs text-red-500",children:S.name}),e.jsxs("select",{className:"border rounded px-2 py-1 flex-1 min-w-0",value:N.layoutType,onChange:t=>z({...N,layoutType:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Layout Type"}),e.jsx("option",{value:"1/2",children:"1/2 (1 Left, 2 Right)"}),e.jsx("option",{value:"2/1",children:"2/1 (2 Left, 1 Right)"}),e.jsx("option",{value:"2/2",children:"2/2 (2 Left, 2 Right)"}),e.jsx("option",{value:"3/2",children:"3/2 (3 Left, 2 Right)"}),e.jsx("option",{value:"4/2",children:"4/2 (4 Left, 2 Right)"})]}),S.layoutType&&e.jsx("div",{className:"text-xs text-red-500",children:S.layoutType}),e.jsx("input",{className:"border rounded px-2 py-1 w-24 flex-shrink-0",type:"number",placeholder:"Seat Count","aria-label":"Seat Count",value:N.seatCount,onChange:t=>z({...N,seatCount:Number(t.target.value)})}),S.seatCount&&e.jsx("div",{className:"text-xs text-red-500",children:S.seatCount}),e.jsxs(b,{onClick:ht,"aria-label":"Confirm add bus",disabled:j==="createBus",children:[j==="createBus"?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mr-2"}):null," ","Add"]}),e.jsx("div",{className:"text-xs text-muted-foreground ml-2 mt-2 md:mt-0",children:"Enter bus name, layout type, and seat count"})]})})]}),e.jsxs(G,{children:[e.jsx(J,{children:e.jsx(K,{children:"Fleets"})}),e.jsx(Q,{children:U?e.jsx(Pe,{className:"h-8 w-full"}):f.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No buses found"}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-end",children:[e.jsxs("select",{value:ye,onChange:t=>Ke(t.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"All Layouts"}),[...new Set(f.map(t=>t.layoutType))].map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"number",value:we,onChange:t=>Qe(t.target.value?Number(t.target.value):""),placeholder:"Min Seats",className:"border rounded px-2 py-1 w-24"}),e.jsx("input",{type:"number",value:ve,onChange:t=>Ue(t.target.value?Number(t.target.value):""),placeholder:"Max Seats",className:"border rounded px-2 py-1 w-24"}),e.jsxs("select",{value:Ne,onChange:t=>We(t.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"All Routes"}),h.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.origin," - ",t.destination,")"]},t.id))]}),e.jsx(b,{onClick:()=>{Ke(""),Qe(""),Ue(""),We("")},children:"Clear"})]}),e.jsxs(Me,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Layout"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Seat Count"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Routes"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{children:vt.map(t=>e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.name}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.layoutType}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.seatCount}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.schedules.map(r=>{var x,A,o;return((x=r.route)==null?void 0:x.name)||`${(A=r.route)==null?void 0:A.origin} - ${(o=r.route)==null?void 0:o.destination}`}).filter(Boolean).join(", ")||"-"}),e.jsxs("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",className:"mr-2",onClick:()=>pt(t),"aria-label":`Edit bus ${t.name}`,children:e.jsx("span",{children:"Edit"})}),e.jsx(ze,{open:!!s&&w===t.id,onOpenChange:r=>{r||(i(null),V(null))},children:e.jsxs(qe,{children:[e.jsx(He,{children:e.jsx(Ve,{children:"Edit Bus"})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{className:"border rounded px-2 py-1",placeholder:"Bus Name",value:(s==null?void 0:s.name)||"",onChange:r=>i(s?{...s,name:r.target.value}:null)}),S.name&&e.jsx("div",{className:"text-xs text-red-500",children:S.name}),e.jsxs("select",{className:"border rounded px-2 py-1",value:(s==null?void 0:s.layoutType)||"",onChange:r=>i(s?{...s,layoutType:r.target.value}:null),children:[e.jsx("option",{value:"",children:"Select Layout Type"}),e.jsx("option",{value:"1/2",children:"1/2 (1 Left, 2 Right)"}),e.jsx("option",{value:"2/1",children:"2/1 (2 Left, 1 Right)"}),e.jsx("option",{value:"2/2",children:"2/2 (2 Left, 2 Right)"}),e.jsx("option",{value:"3/2",children:"3/2 (3 Left, 2 Right)"}),e.jsx("option",{value:"4/2",children:"4/2 (4 Left, 2 Right)"})]}),S.layoutType&&e.jsx("div",{className:"text-xs text-red-500",children:S.layoutType}),e.jsx("input",{className:"border rounded px-2 py-1",type:"number",placeholder:"Seat Count",value:(s==null?void 0:s.seatCount)||0,onChange:r=>i(s?{...s,seatCount:Number(r.target.value)}:null)}),S.seatCount&&e.jsx("div",{className:"text-xs text-red-500",children:S.seatCount})]}),e.jsx(Ye,{children:e.jsxs(b,{onClick:ft,disabled:j===`updateBus_${w}`,children:[j===`updateBus_${w}`?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mr-2"}):null," ","Save"]})})]})}),e.jsxs(b,{size:"sm",variant:"destructive",onClick:()=>{$("bus"),_(t.id)},disabled:j===`deleteBus_${t.id}`,"aria-label":`Delete bus ${t.name}`,children:[j===`deleteBus_${t.id}`?e.jsx("div",{className:"w-3 h-3 border-2 border-gray-300 border-t-red-600 rounded-full animate-spin mr-1"}):null,e.jsx("span",{children:"Delete"})]}),e.jsx(Ae,{open:L==="bus"&&O===t.id,onOpenChange:r=>{r||($(null),_(null))},children:e.jsxs(Fe,{children:[e.jsxs(Ee,{children:[e.jsx(Le,{children:"Delete Bus"}),e.jsx("p",{children:"Are you sure you want to delete this bus?"})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Cancel"}),e.jsx(_e,{onClick:Te,children:"Delete"})]})]})})]})]},t.id))})]})]})})]})]}),e.jsxs(Je,{value:"routes",children:[q&&e.jsxs(G,{className:"mb-4 transition-all duration-300 ease-in-out",children:[e.jsx(J,{children:e.jsx(K,{children:"Add New Route"})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-2 items-stretch md:items-center",children:[e.jsx("input",{className:"border rounded px-2 py-1 flex-1 min-w-0",placeholder:"Route Name","aria-label":"Route Name",value:C.name,onChange:t=>H({...C,name:t.target.value})}),R.name&&e.jsx("div",{className:"text-xs text-red-500",children:R.name}),e.jsx("input",{className:"border rounded px-2 py-1 flex-1 min-w-0",placeholder:"Origin","aria-label":"Origin",value:C.origin,onChange:t=>H({...C,origin:t.target.value})}),R.origin&&e.jsx("div",{className:"text-xs text-red-500",children:R.origin}),e.jsx("input",{className:"border rounded px-2 py-1 flex-1 min-w-0",placeholder:"Destination","aria-label":"Destination",value:C.destination,onChange:t=>H({...C,destination:t.target.value})}),R.destination&&e.jsx("div",{className:"text-xs text-red-500",children:R.destination}),e.jsxs(b,{onClick:xt,"aria-label":"Confirm add route",disabled:j==="createRoute",children:[j==="createRoute"?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mr-2"}):null," ","Add"]}),e.jsx("div",{className:"text-xs text-muted-foreground ml-2 mt-2 md:mt-0",children:"Enter route name, origin, and destination"})]})})]}),e.jsxs(G,{children:[e.jsx(J,{children:e.jsx(K,{children:"Routes"})}),e.jsx(Q,{children:B?e.jsx(Pe,{className:"h-8 w-full"}):h.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No routes found"}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-end",children:[e.jsxs("select",{value:Ce,onChange:t=>Xe(t.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"All Origins"}),[...new Set(h.map(t=>t.origin))].map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:Se,onChange:t=>Ze(t.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"All Destinations"}),[...new Set(h.map(t=>t.destination))].map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(b,{onClick:()=>{Xe(""),Ze("")},children:"Clear"})]}),e.jsxs(Me,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Origin"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Destination"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{children:Nt.map(t=>e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.name}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.origin}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.destination}),e.jsxs("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",className:"mr-2",onClick:()=>gt(t),"aria-label":`Edit route ${t.name}`,children:e.jsx("span",{children:"Edit"})}),e.jsx(ze,{open:!!y&&le===t.id,onOpenChange:r=>{r||(Y(null),fe(null))},children:e.jsxs(qe,{children:[e.jsx(He,{children:e.jsx(Ve,{children:"Edit Route"})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{className:"border rounded px-2 py-1",placeholder:"Route Name",value:(y==null?void 0:y.name)||"",onChange:r=>Y(y?{...y,name:r.target.value}:null)}),R.name&&e.jsx("div",{className:"text-xs text-red-500",children:R.name}),e.jsx("input",{className:"border rounded px-2 py-1",placeholder:"Origin",value:(y==null?void 0:y.origin)||"",onChange:r=>Y(y?{...y,origin:r.target.value}:null)}),R.origin&&e.jsx("div",{className:"text-xs text-red-500",children:R.origin}),e.jsx("input",{className:"border rounded px-2 py-1",placeholder:"Destination",value:(y==null?void 0:y.destination)||"",onChange:r=>Y(y?{...y,destination:r.target.value}:null)}),R.destination&&e.jsx("div",{className:"text-xs text-red-500",children:R.destination})]}),e.jsx(Ye,{children:e.jsxs(b,{onClick:bt,disabled:j===`updateRoute_${le}`,children:[j===`updateRoute_${le}`?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mr-2"}):null," ","Save"]})})]})}),e.jsxs(b,{size:"sm",variant:"destructive",onClick:()=>{$("route"),_(t.id)},disabled:j===`deleteRoute_${t.id}`,"aria-label":`Delete route ${t.name}`,children:[j===`deleteRoute_${t.id}`?e.jsx("div",{className:"w-3 h-3 border-2 border-gray-300 border-t-red-600 rounded-full animate-spin mr-1"}):null,e.jsx("span",{children:"Delete"})]}),e.jsx(Ae,{open:L==="route"&&O===t.id,onOpenChange:r=>{r||($(null),_(null))},children:e.jsxs(Fe,{children:[e.jsxs(Ee,{children:[e.jsx(Le,{children:"Delete Route"}),e.jsx("p",{children:"Are you sure you want to delete this route?"})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Cancel"}),e.jsx(_e,{onClick:Te,children:"Delete"})]})]})})]})]},t.id))})]})]})})]})]}),e.jsxs(Je,{value:"schedules",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Schedules"}),e.jsx(b,{onClick:()=>a(t=>!t),children:re?"Cancel":"Add Schedule"})]}),re&&e.jsxs(G,{className:"mb-4 transition-all duration-300 ease-in-out",children:[e.jsx(J,{children:e.jsx(K,{children:"Add New Schedule"})}),e.jsx(Q,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Route"}),e.jsxs("select",{className:`border rounded px-3 py-2 w-full ${g.routeId?"border-red-500":"border-gray-300"}`,value:l.routeId,onChange:t=>{const r=Number(t.target.value);d({...l,routeId:r}),r>0&&T(x=>({...x,routeId:void 0}))},children:[e.jsx("option",{value:0,children:"Select Route"}),h.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.origin," - ",t.destination,")"]},t.id))]}),g.routeId&&e.jsx("div",{className:"text-sm text-red-600 font-medium",children:g.routeId})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Bus"}),e.jsxs("select",{className:`border rounded px-3 py-2 w-full ${g.busId?"border-red-500":"border-gray-300"}`,value:l.busId,onChange:t=>{const r=Number(t.target.value);d({...l,busId:r}),r>0&&T(x=>({...x,busId:void 0}))},children:[e.jsx("option",{value:0,children:"Select Bus"}),f.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),g.busId&&e.jsx("div",{className:"text-sm text-red-600 font-medium",children:g.busId})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Departure"}),e.jsx("input",{className:`border rounded px-3 py-2 w-full ${g.departure?"border-red-500":"border-gray-300"}`,type:"datetime-local",value:l.departure,onChange:t=>{const r=t.target.value;d({...l,departure:r}),r&&T(x=>({...x,departure:void 0}))}}),g.departure&&e.jsx("div",{className:"text-sm text-red-600 font-medium",children:g.departure})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Fare"}),e.jsx("input",{className:`border rounded px-3 py-2 w-full ${g.fare?"border-red-500":"border-gray-300"}`,type:"number",placeholder:"Enter fare amount",value:l.fare,onChange:t=>{const r=Number(t.target.value);d({...l,fare:r}),r>0&&T(x=>({...x,fare:void 0}))}}),g.fare&&e.jsx("div",{className:"text-sm text-red-600 font-medium",children:g.fare})]}),e.jsx("div",{className:"space-y-2 flex items-center",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:l.isReturn,onChange:t=>d({...l,isReturn:t.target.checked}),className:"rounded border-gray-300"}),"Return Trip"]})}),e.jsx("div",{className:"space-y-2 flex items-end",children:e.jsxs(b,{onClick:mt,disabled:j==="createSchedule"||!ut(),className:"w-full",children:[j==="createSchedule"?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mr-2"}):null,"Add Schedule"]})})]}),Object.keys(g).length>0&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-red-700 font-medium mb-2",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-600 space-y-1",children:Object.entries(g).map(([t,r])=>e.jsxs("li",{children:["• ",r]},t))})]})]})})]}),e.jsxs(G,{children:[e.jsx(J,{children:e.jsx(K,{children:"Schedules"})}),e.jsx(Q,{children:ce?e.jsx(Pe,{className:"h-8 w-full"}):M.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No schedules found"}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-end",children:[e.jsxs("select",{value:Re,onChange:t=>et(t.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"All Routes"}),h.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.origin," - ",t.destination,")"]},t.id))]}),e.jsxs("select",{value:ke,onChange:t=>tt(t.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"All Buses"}),f.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("input",{type:"date",value:Be,onChange:t=>st(t.target.value),className:"border rounded px-2 py-1"}),e.jsxs("select",{value:De,onChange:t=>at(t.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"oneway",children:"One-way"})]}),e.jsx(b,{onClick:()=>{et(""),tt(""),st(""),at("")},children:"Clear"})]}),e.jsxs(Me,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Route"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Bus"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Layout"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Departure"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Fare"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Return"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{children:Ct.map(t=>{var r,x,A;return e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:((r=h.find(o=>o.id===t.routeId))==null?void 0:r.name)||"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:((x=f.find(o=>o.id===t.busId))==null?void 0:x.name)||"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:((A=f.find(o=>o.id===t.busId))==null?void 0:A.layoutType)||"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.departure?new Date(t.departure).toLocaleString():"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.fare}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t.isReturn?"Yes":"No"}),e.jsxs("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",className:"mr-2",onClick:()=>jt(t),"aria-label":`Edit schedule ${t.id}`,children:e.jsx("span",{children:"Edit"})}),e.jsx(b,{size:"sm",variant:"outline",className:"mr-2",onClick:()=>wt(t.id),"aria-label":`Regenerate seats for schedule ${t.id}`,children:e.jsx("span",{children:"Regenerate Seats"})}),e.jsxs(b,{size:"sm",variant:"destructive",onClick:()=>{$("schedule"),_(t.id)},disabled:j===`deleteSchedule_${t.id}`,children:[j===`deleteSchedule_${t.id}`?e.jsx("div",{className:"w-3 h-3 border-2 border-gray-300 border-t-red-600 rounded-full animate-spin mr-1"}):null,"Delete"]}),e.jsx(Ae,{open:L==="schedule"&&O===t.id,onOpenChange:o=>{o||($(null),_(null))},children:e.jsxs(Fe,{children:[e.jsxs(Ee,{children:[e.jsx(Le,{children:"Delete Schedule"}),e.jsx("p",{children:"Are you sure you want to delete this schedule?"})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Cancel"}),e.jsx(_e,{onClick:Te,children:"Delete"})]})]})}),e.jsx(ze,{open:!!c&&ie===t.id,onOpenChange:o=>{o||(E(null),be(null),T({}))},children:e.jsxs(qe,{children:[e.jsx(He,{children:e.jsx(Ve,{children:"Edit Schedule"})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("select",{className:"border rounded px-2 py-1",value:(c==null?void 0:c.routeId)||0,onChange:o=>E(c?{...c,routeId:Number(o.target.value)}:null),children:[e.jsx("option",{value:0,children:"Select Route"}),h.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",o.origin," -"," ",o.destination,")"]},o.id))]}),g.routeId&&e.jsx("div",{className:"text-xs text-red-500",children:g.routeId}),e.jsxs("select",{className:"border rounded px-2 py-1",value:(c==null?void 0:c.busId)||0,onChange:o=>E(c?{...c,busId:Number(o.target.value)}:null),children:[e.jsx("option",{value:0,children:"Select Bus"}),f.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]}),g.busId&&e.jsx("div",{className:"text-xs text-red-500",children:g.busId}),e.jsx("input",{className:"border rounded px-2 py-1",type:"datetime-local",value:(c==null?void 0:c.departure)||"",onChange:o=>E(c?{...c,departure:o.target.value}:null)}),g.departure&&e.jsx("div",{className:"text-xs text-red-500",children:g.departure}),e.jsx("input",{className:"border rounded px-2 py-1",type:"number",placeholder:"Fare",value:(c==null?void 0:c.fare)||0,onChange:o=>E(c?{...c,fare:Number(o.target.value)}:null)}),g.fare&&e.jsx("div",{className:"text-xs text-red-500",children:g.fare}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:(c==null?void 0:c.isReturn)||!1,onChange:o=>E(c?{...c,isReturn:o.target.checked}:null)}),"Return"]})]}),e.jsx(Ye,{children:e.jsxs(b,{onClick:yt,disabled:j===`updateSchedule_${ie}`,children:[j===`updateSchedule_${ie}`?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mr-2"}):null," ","Save"]})})]})})]})]},t.id)})})]})]})})]})]})]})]})})};export{Yt as default};
