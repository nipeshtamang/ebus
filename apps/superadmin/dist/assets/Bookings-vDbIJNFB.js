import{j as e,aw as O,ax as I,ag as N}from"./ui-vendor-Dho0S5x9.js";import{a as s}from"./react-vendor-ByNQKlCH.js";import{C as S,a as B,b as T,d as D}from"./card-C7BQZI4A.js";import{B as k,T as M,a as V,b as z,d as $,A as H,e as K,f as R,g as U,h as q,i as G,j as J,k as Q}from"./index-DMYsCFYG.js";import{T as W}from"./table-DNDMFJuf.js";import{S as X}from"./skeleton-XnDLFZGi.js";import{E as Y}from"./error-message-D3zDD8H-.js";import{B as Z}from"./badge-C0YrEax5.js";import{I as _}from"./input-DM7v_Vsi.js";import{S as ee,a as se,b as ae,c as te,d as w}from"./select-DacTrhsM.js";import{b as E}from"./superadminApi-Bjf7uKUS.js";import"./query-vendor-Br3W6GMP.js";import"./utils-vendor-Dq7h7Pqt.js";function le(){const[c,p]=s.useState([]),[r,j]=s.useState(0),[f,u]=s.useState(0),[h,C]=s.useState(1),[n,i]=s.useState(!1),[b,g]=s.useState(null),d=s.useCallback(async o=>{i(!0),g(null);try{const t=await E.getAllBookings(o);p(t.data.bookings),j(t.data.total),u(t.data.totalPages),C(t.data.currentPage)}catch(t){g(t instanceof Error?t.message:"Failed to load bookings")}finally{i(!1)}},[]),x=s.useCallback(async o=>{i(!0),g(null);try{await E.cancelBooking(o),await d({page:h})}catch(t){g(t instanceof Error?t.message:"Failed to cancel booking")}finally{i(!1)}},[d,h]);return{bookings:c,total:r,totalPages:f,currentPage:h,loading:n,error:b,fetchBookings:d,cancelBooking:x,setCurrentPage:C}}function re(){const{bookings:c,totalPages:p,currentPage:r,loading:j,error:f,fetchBookings:u,cancelBooking:h,setCurrentPage:C}=le(),[n,i]=s.useState({searchTerm:"",statusFilter:"all"}),[b,g]=s.useState(c),[d,x]=s.useState(!1),[o,t]=s.useState(null);s.useEffect(()=>{let a=c;n.searchTerm&&(a=a.filter(m=>m.id.toString().includes(n.searchTerm.toLowerCase())||m.user?.name?.toLowerCase().includes(n.searchTerm.toLowerCase()))),n.statusFilter!=="all"&&(a=a.filter(m=>m.status===n.statusFilter)),g(a)},[c,n.searchTerm,n.statusFilter]);const y=s.useCallback(a=>{i(m=>({...m,searchTerm:a}))},[]),l=s.useCallback(a=>{i(m=>({...m,statusFilter:a}))},[]),v=s.useCallback(a=>{switch(a){case"COMPLETED":return"bg-green-100 text-green-800 border-green-200";case"CANCELLED":return"bg-red-100 text-red-800 border-red-200";case"BOOKED":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},[]),A=s.useCallback(a=>{t(a),x(!0)},[]),P=s.useCallback(async()=>{if(o)try{return await h(o),{success:!0}}catch(a){return{success:!1,error:a}}finally{x(!1),t(null)}return{success:!1}},[o,h]),F=s.useCallback(()=>{x(!1),t(null)},[]),L=s.useCallback(a=>a!=="COMPLETED"&&a!=="CANCELLED",[]);return{bookings:b,totalPages:p,currentPage:r,loading:j,error:f,filters:n,updateSearchTerm:y,updateStatusFilter:l,showCancelDialog:d,selectedBookingId:o,handleCancel:A,confirmCancel:P,closeCancelDialog:F,fetchBookings:u,setCurrentPage:C,getStatusBadgeVariant:v,canCancelBooking:L}}const je=()=>{const{bookings:c,totalPages:p,currentPage:r,loading:j,error:f,filters:u,updateSearchTerm:h,updateStatusFilter:C,showCancelDialog:n,handleCancel:i,confirmCancel:b,closeCancelDialog:g,fetchBookings:d,setCurrentPage:x,getStatusBadgeVariant:o,canCancelBooking:t}=re();s.useEffect(()=>{d({page:r})},[d,r]);const y=async()=>{(await b()).success?N.success("Booking cancelled successfully!"):N.error("Failed to cancel booking")};return e.jsx("div",{className:"w-full min-h-screen bg-gradient-to-br from-white to-teal-50",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-6",children:"Bookings"}),f&&e.jsx(Y,{message:f,onRetry:()=>d({page:r})}),e.jsxs(S,{className:"mb-6",children:[e.jsx(B,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Filters"]})}),e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(_,{placeholder:"Search by booking ID or user name...",value:u.searchTerm,onChange:l=>h(l.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(ee,{value:u.statusFilter,onValueChange:C,children:[e.jsx(se,{children:e.jsx(ae,{placeholder:"Filter by status"})}),e.jsxs(te,{children:[e.jsx(w,{value:"all",children:"All Statuses"}),e.jsx(w,{value:"BOOKED",children:"Booked"}),e.jsx(w,{value:"COMPLETED",children:"Completed"}),e.jsx(w,{value:"CANCELLED",children:"Cancelled"})]})]})})]})})]}),e.jsxs(S,{children:[e.jsx(B,{children:e.jsxs(T,{children:["All Bookings (",c.length,")"]})}),e.jsx(D,{children:j?e.jsx(X,{className:"h-8 w-full"}):c.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:u.searchTerm||u.statusFilter!=="all"?"No bookings match your filters":"No bookings found"}):e.jsxs(W,{className:"min-w-[900px] border-separate border-spacing-y-2 border-spacing-x-4 rounded-xl bg-white shadow-md",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Created At"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700 whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{children:c.map(l=>e.jsxs("tr",{className:"even:bg-gray-50 hover:bg-teal-50 transition-colors rounded-xl",children:[e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:l.id}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:l.user?.name||"-"}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:e.jsx(Z,{className:`${o(l.status)} border`,children:l.status})}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:new Date(l.createdAt).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 bg-white rounded-lg shadow-sm whitespace-nowrap",children:t(l.status)?e.jsx(k,{size:"sm",variant:"destructive",onClick:()=>i(l.id),"aria-label":`Cancel booking ${l.id}`,children:e.jsx(M,{children:e.jsxs(V,{children:[e.jsx(z,{asChild:!0,children:e.jsx("span",{children:"Cancel"})}),e.jsx($,{children:"Cancel this booking"})]})})}):e.jsx("span",{className:`text-sm font-medium ${l.status==="COMPLETED"?"text-green-600":"text-red-600"}`,children:l.status==="COMPLETED"?"Completed":"Cancelled"})})]},l.id))})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(k,{size:"sm",variant:"outline",disabled:r===1,onClick:()=>x(r-1),children:"Previous"}),e.jsxs("span",{className:"px-2 py-1",children:["Page ",r," of ",p]}),e.jsx(k,{size:"sm",variant:"outline",disabled:r===p,onClick:()=>x(r+1),children:"Next"})]}),e.jsx(H,{open:n,onOpenChange:g,children:e.jsxs(K,{children:[e.jsxs(R,{children:[e.jsx(U,{children:"Confirm Cancel"}),e.jsx(q,{children:"Are you sure you want to cancel this booking? This action cannot be undone and the seat will be released for others to book. A cancellation email will be sent to the customer."})]}),e.jsxs(G,{children:[e.jsx(J,{children:"Cancel"}),e.jsx(Q,{onClick:y,className:"bg-red-600 hover:bg-red-700",children:"Cancel Booking"})]})]})})]})})};export{je as default};
